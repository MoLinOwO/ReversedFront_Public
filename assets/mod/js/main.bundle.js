/*! For license information please see main.bundle.js.LICENSE.txt */
(()=>{var e,t={182:()=>{!function(){function e(e){if("string"!=typeof e)return null;const t=e.toLowerCase().replace(/\\/g,"/");return t.endsWith(".mp3")?t.includes("se147.mp3")?"SE147":t.includes("audio/music/")||t.includes("passionfruit/audio/music/")?"BGM":(t.includes("passionfruit/audio/"),"SE"):null}const t=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"src"),n=HTMLMediaElement.prototype.play,o=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"volume"),i=HTMLMediaElement.prototype.load;document.addEventListener("error",function(e){"AUDIO"!==e.target.tagName&&"VIDEO"!==e.target.tagName||(console.warn("[åª’é«”åŠ è¼‰å¤±æ•— - å·²é˜»æ­¢å†’æ³¡]",{tag:e.target.tagName,src:e.target.src,currentSrc:e.target.currentSrc,error:e.target.error}),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())},!0),HTMLMediaElement.prototype.load=function(){return this._rfErrorHandler&&this.removeEventListener("error",this._rfErrorHandler),this._rfErrorHandler=function(e){console.warn("[åª’é«”åŠ è¼‰éŒ¯èª¤ - å·²æ•ç²]",{tag:this.tagName,src:this.src,currentSrc:this.currentSrc,errorCode:this.error?this.error.code:"unknown",errorMessage:this.error?this.error.message:"unknown"}),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}.bind(this),this.addEventListener("error",this._rfErrorHandler,!0),i.call(this)},Object.defineProperty(HTMLMediaElement.prototype,"src",{...t,set:function(n){if(console.log(`%c[éŸ³è¨Š] src setter è¢«èª¿ç”¨: ${n}`,"color: #00aaff; font-size: 11px"),this._rf_loading_cdn&&!n.startsWith("http"))return void console.log(`%c[éŸ³è¨Š] æ­£åœ¨åŠ è¼‰ CDNï¼Œå¿½ç•¥é‡è¨­: ${n}`,"color: #ff9800; font-size: 11px");let o=n;"string"==typeof n&&n.startsWith("undefined/")&&(o=n.substring(10));const i=e(o);if(this._rf_type=i,null===i)return console.log(`%c[éŸ³è¨Š] éžéŸ³è¨Šæª”æ¡ˆï¼Œç›´æŽ¥è¨­ç½®: ${o}`,"color: #888; font-size: 10px"),t.set.call(this,o);if("string"==typeof o&&window.__TAURI__){if(o.startsWith("http://")||o.startsWith("https://")){console.log(`%c[éŸ³è¨Š] å®Œæ•´ URLï¼Œä¸æ””æˆª: ${o}`,"color: #888; font-size: 10px"),this._rf_loading_cdn=!0;try{this.pause(),this.currentTime=0}catch(e){}t.set.call(this,o),this.volume="BGM"===i?window._rf_bgm_volume??1:window._rf_se_volume??1;try{this.load(),console.log(`%c[éŸ³è¨Š] CDN URL å·²è¨­ç½®ä¸¦é‡æ–°åŠ è¼‰: ${o}`,"color: #00ff00; font-size: 11px")}catch(e){console.warn("[éŸ³è¨Š] load() èª¿ç”¨å¤±æ•—:",e)}return}{let e,t=!1;const n=o.match(/(?:assets\/)?passionfruit\/(.+)$/);if(n)e=n[1],t=!0;else{let n=o.replace(/^\.\//,"");n.startsWith("static/")?t=!1:(e=n,t=!0)}const i=o;t?(o=`http://localhost:8765/passionfruit/${e}`,console.log(`%c[éŸ³è¨Š] é‡å®šå‘: ${i} -> ${o}`,"color: #00ff00; font-size: 11px")):console.log(`%c[éŸ³è¨Š] ä¸æ””æˆª: ${i}`,"color: #888; font-size: 11px")}}return this.volume="BGM"===i?window._rf_bgm_volume??1:window._rf_se_volume??1,t.set.call(this,o)}}),HTMLMediaElement.prototype.play=function(){const t=this._rf_type||e(this.currentSrc||this.src);if(null===t){const e=n.apply(this,arguments);return e&&e.catch?e.catch(e=>(console.warn("[åª’é«”æ’­æ”¾å¤±æ•— - å·²æ•ç²]",{tag:this.tagName,src:this.src,currentSrc:this.currentSrc,error:e.name+": "+e.message}),Promise.resolve())):e}if(this.src&&(this.src.startsWith("http://")||this.src.startsWith("https://"))&&this.src!==this.currentSrc&&!this.src.includes("localhost:8765")){console.log(`%c[éŸ³è¨Š] ç­‰å¾… CDN URL åŠ è¼‰å®Œæˆ: ${this.src}`,"color: #ff9800; font-size: 11px");const e=this;return new Promise((t,o)=>{const i=setTimeout(()=>{console.warn("[éŸ³è¨Š] ç­‰å¾… loadedmetadata è¶…æ™‚ï¼Œå˜—è©¦ç›´æŽ¥æ’­æ”¾"),e._rf_loading_cdn=!1,n.apply(e,arguments).then(t).catch(e=>{console.warn("[éŸ³è¨Š] CDN æ’­æ”¾å¤±æ•—:",e),t()})},2e3),r=()=>{clearTimeout(i),e.removeEventListener("loadedmetadata",r),e._rf_loading_cdn=!1,console.log(`%c[éŸ³è¨Š] CDN è³‡æºå·²åŠ è¼‰ï¼ŒcurrentSrc: ${e.currentSrc}`,"color: #00ff00; font-size: 11px"),n.apply(e,arguments).then(t).catch(e=>{console.warn("[éŸ³è¨Š] CDN æ’­æ”¾å¤±æ•—:",e),t()})};e.readyState>=1?(clearTimeout(i),e._rf_loading_cdn=!1,console.log(`%c[éŸ³è¨Š] CDN è³‡æºå·²å°±ç·’ï¼ŒcurrentSrc: ${e.currentSrc}`,"color: #00ff00; font-size: 11px"),n.apply(e,arguments).then(t).catch(e=>{console.warn("[éŸ³è¨Š] CDN æ’­æ”¾å¤±æ•—:",e),t()})):e.addEventListener("loadedmetadata",r)})}if("SE147"===t&&window._rf_se147Muted)return this.pause(),this.currentTime=0,Promise.resolve();const o=n.apply(this,arguments);return o&&o.catch?o.catch(e=>(console.warn("[éŸ³è¨Šæ’­æ”¾å¤±æ•— - å·²æ•ç²]",{type:t,src:this.src,currentSrc:this.currentSrc,error:e.name+": "+e.message}),"NotSupportedError"===e.name&&this.src&&this.src.includes("localhost:8765")&&console.log("[éŸ³è¨Š] è³‡æºå¯èƒ½æ­£åœ¨ä¸‹è¼‰ï¼Œå°‡åœ¨å¾Œå°ç­‰å¾…..."),Promise.resolve())):o},o&&Object.defineProperty(HTMLMediaElement.prototype,"volume",{get:o.get,set:function(t){const n=this._rf_type||e(this.currentSrc||this.src);if(null===n)return o.set.call(this,t);let i;this._rf_intended_volume=t,i="BGM"===n?window._rf_bgm_volume??1:window._rf_se_volume??1,o.get.call(this)!==i&&o.set.call(this,i)}});const r=window.Audio;function a(){window._rf_is_setting_volume=!0;try{document.querySelectorAll("audio,video").forEach(t=>{const n=t._rf_type||e(t.currentSrc||t.src||"");"BGM"===n?t.volume=window._rf_bgm_volume??1:"SE147"===n?(t.volume=window._rf_se_volume??1,t.muted=window._rf_se147Muted):t.volume=window._rf_se_volume??1})}finally{window._rf_is_setting_volume=!1}}window.Audio=function(e){return new r(e)},window.Audio.prototype=r.prototype,window._rf_bgm_volume=1,window._rf_se_volume=1,window._rf_se147Muted=!1,window._rf_bgmGainNodes=[],window._rf_seGainNodes=[];let l=null,s=null,c=null;function d(){if(s&&l){const e=window._rf_se147Muted?0:window._rf_se_volume;s.gain.setValueAtTime(e,l.currentTime)}}window.setBGMVolume=function(e){window._rf_bgm_volume=e,a(),window._rf_bgmGainNodes.forEach(t=>{t&&t.gain&&(t.gain.value=e)}),window.pywebview&&window.pywebview.api&&window.pywebview.api.save_config_volume?window.pywebview.api.save_config_volume({bgm:e,se:window._rf_se_volume,se147Muted:window._rf_se147Muted}).catch(e=>{console.error("éŸ³é‡è¨­å®šä¿å­˜å¤±æ•—",e)}):console.warn("pywebview API å°šæœªæ³¨å…¥ï¼ŒéŸ³é‡è¨­å®šæœªä¿å­˜")},window.setSEVolume=function(e){window._rf_se_volume=e,a(),window._rf_seGainNodes.forEach(t=>{t&&t.gain&&(t.gain.value=e)}),d(),window.pywebview&&window.pywebview.api&&window.pywebview.api.save_config_volume?window.pywebview.api.save_config_volume({bgm:window._rf_bgm_volume,se:e,se147Muted:window._rf_se147Muted}).catch(e=>{console.error("éŸ³é‡è¨­å®šä¿å­˜å¤±æ•—",e)}):console.warn("pywebview API å°šæœªæ³¨å…¥ï¼ŒéŸ³é‡è¨­å®šæœªä¿å­˜")},window.setSE147Muted=function(e,t=!1){window._rf_se147Muted=e,a(),d();const n=document.getElementById("se147-toggle-button"),o=document.getElementById("se147-toggle");n&&(n.textContent="æˆ°å ±é€šçŸ¥ï¼š"+(e?"é—œ":"é–‹"),n.style.backgroundColor=e?"#d9534f":"#5cb85c"),o&&(o.checked=e),t||(window.pywebview&&window.pywebview.api&&window.pywebview.api.save_config_volume?window.pywebview.api.save_config_volume({bgm:window._rf_bgm_volume,se:window._rf_se_volume,se147Muted:e}).catch(e=>{console.error("æˆ°å ±é€šçŸ¥ç‹€æ…‹ä¿å­˜å¤±æ•—",e)}):console.warn("pywebview API å°šæœªæ³¨å…¥ï¼Œæˆ°å ±é€šçŸ¥ç‹€æ…‹æœªä¿å­˜"))},window.forceUpdateSE147Button=function(){const e=document.getElementById("se147-toggle-button"),t=document.getElementById("se147-toggle");if(e&&t){const n=!window._rf_se147Muted;t.checked=n,e.textContent="æˆ°å ±é€šçŸ¥ï¼š"+(n?"é–‹":"é—œ"),e.style.backgroundColor=n?"#5cb85c":"#d9534f"}};const u=window.AudioContext||window.webkitAudioContext;if(!u)return;const p=new WeakMap,f=window.fetch;window.fetch=function(t,n){const o=e(t instanceof Request?t.url:t),i=f.apply(this,arguments);return o?i.then(e=>{const t=e.clone(),n=t.arrayBuffer;return t.arrayBuffer=function(){return n.apply(this,arguments).then(e=>{try{e._rf_type=o}catch(e){console.warn("RF: Failed to tag ArrayBuffer from fetch",e)}return e})},t}):i};const w=window.XMLHttpRequest.prototype.open,g=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.open=function(t,n,...o){const i=e(n);return i&&(this._rf_type=i,this._rf_url=n),w.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(this._rf_type&&"arraybuffer"===this.responseType){const e=this._rf_type,t=this.onload;this.onload=function(){if(this.response)try{this.response._rf_type=e}catch(e){console.warn("RF: Could not tag ArrayBuffer from XHR:",e)}t&&t.apply(this,arguments)}}return g.apply(this,arguments)};const m=u.prototype.decodeAudioData;u.prototype.decodeAudioData=function(e,...t){const n=e?e._rf_type:null;return n?m.apply(this,[e,...t]).then(e=>(p.set(e,n),e)):m.apply(this,[e,...t])};const y=(window.AudioNode||window.webkitAudioNode)?.prototype;if(y&&y.connect){const e=y.connect;y.connect=function(t){if(this.buffer&&t){const e=p.get(this.buffer);if("SE147"===e)return function(e){if(function(){const e=window.AudioContext||window.webkitAudioContext;if(e&&!l)try{l=new e,s=l.createGain(),s.connect(l.destination),d()}catch(e){console.error("RF: Failed to create dedicated AudioContext for SE147",e)}}(),!l||!s)return;if(window._rf_se147Muted)return;const t=e=>{try{const t=l.createBufferSource();t.buffer=e,t.connect(s),t.start(0)}catch(e){console.error("RF: Error playing SE147 sound:",e)}};if("string"==typeof e){const n=e;c?t(c):f(n).then(e=>e.arrayBuffer()).then(e=>l.decodeAudioData(e)).then(e=>{c=e,t(e)}).catch(e=>console.error("RF: Error fetching/decoding SE147:",e))}else e&&(c||(c=e),t(e))}(this.buffer),t;t.gain&&("BGM"===e?(window._rf_bgmGainNodes.includes(t)||window._rf_bgmGainNodes.push(t),t.gain.value=window._rf_bgm_volume??1):"SE"===e&&(window._rf_seGainNodes.includes(t)||window._rf_seGainNodes.push(t),t.gain.value=window._rf_se_volume??1))}return e.apply(this,arguments)}}window.applyAudioConfig=function(e){e&&("number"==typeof e.bgm&&(window._rf_bgm_volume=e.bgm,window._rf_bgmGainNodes&&Array.isArray(window._rf_bgmGainNodes)&&window._rf_bgmGainNodes.forEach(t=>{t&&t.gain&&(t.gain.value=e.bgm)}),window.setMediaVolume&&window.setMediaVolume()),"number"==typeof e.se&&(window._rf_se_volume=e.se,window._rf_seGainNodes&&Array.isArray(window._rf_seGainNodes)&&window._rf_seGainNodes.forEach(t=>{t&&t.gain&&(t.gain.value=e.se)}),window.setMediaVolume&&window.setMediaVolume(),window.updateSe147Volume&&window.updateSe147Volume()),"boolean"==typeof e.se147Muted&&window.setSE147Muted&&window.setSE147Muted(e.se147Muted,!0),console.log("éŸ³é »é…ç½®å·²æ‡‰ç”¨:",e))}}()},191:(e,t,n)=>{"use strict";n.d(t,{J7:()=>a,_r:()=>s,getCityName:()=>i,getMarkerId:()=>r,ph:()=>l});const o={"rgb(0, 138, 247)":"è’™å¤","rgb(6, 133, 158)":"è‡ºç£","rgb(252, 185, 0)":"æ»¿æ´²","rgb(174, 67, 236)":"é¦™æ¸¯","rgb(255, 255, 255)":"åè³Šè¯ç›Ÿ","rgb(70, 190, 127)":"è—åœ‹","rgb(116, 160, 246)":"ç¶­å¾çˆ¾","rgb(0, 233, 228)":"å“ˆè–©å…‹","rgb(253, 30, 25)":"ç´…è»","rgb(109, 109, 109)":"æ–°ä¸­åœ‹ç‹‚æ­¡"};function i(e){let t=e.parentElement&&e.parentElement.querySelector('[class*="CityName"], [class*="cityName"]');return t?t.textContent.trim():e.style.left+","+e.style.top}function r(e){return e.style.left+"_"+e.style.top}function a(e){return o[e]||"æœªçŸ¥"}function l(e,t){const n=new Set;return Object.values(e).forEach(e=>{Array.isArray(e[t])?e[t].forEach(e=>n.add(e)):e[t]&&n.add(e[t])}),Array.from(n).filter(Boolean)}function s(e){const t=new Set;return Object.values(e).forEach(e=>{Array.isArray(e.reward)&&e.reward.length&&t.add(e.reward.join(","))}),Array.from(t).filter(Boolean)}},289:()=>{!function(){const e=window.fetch;window.fetch=async function(t,n){let o=t;if(t instanceof Request&&(o=t.url),o.match(/^(http|https|data|blob):/i)&&!o.includes("localhost:8765"))return e.apply(this,arguments);let i=o.replace(/^[\.\/]+/,"");if(i.startsWith("assets/")&&(i=i.substring(7)),i.startsWith("passionfruit/")&&window.__TAURI__){const t=`http://localhost:8765/${i}`;return window.DEBUG_MODE&&console.log(`[ResourceCache] Fetch é‡å®šå‘ ${o} -> ${t}`),e(t)}return e.apply(this,arguments)};const t=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,n,o,i,r){if(n.match(/^(http|https|data|blob):/i)&&!n.includes("localhost:8765"))return t.apply(this,arguments);let a=n.replace(/^[\.\/]+/,"");if(a.startsWith("assets/")&&(a=a.substring(7)),a.startsWith("passionfruit/")&&window.__TAURI__){const l=`http://localhost:8765/${a}`;return window.DEBUG_MODE&&console.log(`[ResourceCache] XHR é‡å®šå‘ ${n} -> ${l}`),t.call(this,e,l,o,i,r)}return t.apply(this,arguments)};const n=Object.getOwnPropertyDescriptor(HTMLImageElement.prototype,"src");Object.defineProperty(HTMLImageElement.prototype,"src",{get:function(){return n.get.call(this)},set:function(e){const t=String(e);if(!t.includes("passionfruit"))return void n.set.call(this,e);if(t.match(/^(http|https|data|blob):/i)&&!t.includes("localhost:8765"))return void n.set.call(this,e);let o=t.replace(/^[\.\/]+/,"");if(o.startsWith("assets/")&&(o=o.substring(7)),o.startsWith("passionfruit/")&&window.__TAURI__){const t=`http://localhost:8765/${o}`;return window.DEBUG_MODE&&console.log(`[ResourceCache] Image é‡å®šå‘ ${e} -> ${t}`),void n.set.call(this,t)}n.set.call(this,e)},configurable:!0}),window.DEBUG_MODE=!1,window.DEBUG_MODE&&console.log("[ResourceCache] è³‡æºç›£æŽ§å·²å•Ÿå‹•ï¼Œç‹€æ…‹é¡¯ç¤ºå·²æ•´åˆè‡³æŽ§åˆ¶é¢æ¿")}()},356:()=>{try{Object.defineProperty(document,"hidden",{get:function(){return!1},configurable:!0}),Object.defineProperty(document,"visibilityState",{get:function(){return"visible"},configurable:!0}),window.addEventListener("visibilitychange",function(e){e.stopImmediatePropagation(),e.stopPropagation()},!0),console.log("[Tauri] Anti-Sleep & Visibility Override enabled")}catch(e){console.error("[Tauri] Failed to enable Anti-Sleep:",e)}window.pywebview=window.pywebview||{},window.pywebview.api=window.pywebview.api||{};const e=window.__TAURI__.core.invoke,t=window.__TAURI__.window.getCurrentWindow;window.isUnloading=!1,window.addEventListener("beforeunload",()=>{window.isUnloading=!0}),window.pywebview.api.toggle_menu=function(){if(window.toggleControlPanel)window.toggleControlPanel();else{const e=document.getElementById("custom-controls"),t=document.getElementById("custom-controls-toggle");e&&t&&("none"!==e.style.display&&e.style.display?(e.style.display="none",t.style.display="flex"):(e.style.display="block",t.style.display="none"))}},window.pywebview.api.toggle_fullscreen=async function(){console.log("[Tauri Bridge] toggle_fullscreen called");try{const e=t(),n=await e.isFullscreen();return console.log("[Tauri Bridge] Current fullscreen state:",n),await e.setFullscreen(!n),console.log("[Tauri Bridge] Toggled fullscreen to:",!n),!n}catch(e){return console.error("[Tauri Bridge] toggle_fullscreen failed:",e),!1}},window.pywebview.api.set_window_size=async function(e,n){const o=t();return await o.setSize(new window.__TAURI__.window.LogicalSize(e,n)),!0},window.pywebview.api.check_resource_exists=async function(e){try{const t=await fetch(`http://localhost:8765/passionfruit/${e}`,{method:"HEAD",cache:"no-cache"});return{exists:t.ok,downloading:!t.ok,path:e,absPath:""}}catch(t){return console.error("[Tauri Bridge] check_resource_exists failed:",t),{exists:!1,downloading:!1,path:e,absPath:""}}},window.pywebview.api.get_resource_download_status=async function(){try{const e=await fetch("http://localhost:8765/status",{method:"GET",cache:"no-cache"});return e.ok?await e.json():{queueLength:0,isDownloading:!1,activeDownloads:0,maxWorkers:4,downloadedCount:0}}catch(e){return{queueLength:0,isDownloading:!1,activeDownloads:0,maxWorkers:4,downloadedCount:0}}},["get_accounts","add_account","delete_account","set_active_account","get_active_account","save_yaml","load_yaml","exit_app","save_config_volume","get_config_volume","save_report_faction_filter","get_report_faction_filter","log_message","check_for_updates","perform_update"].forEach(t=>{window.pywebview.api[t]=async function(...n){try{let o={};if("add_account"===t?o={data:n[0]}:"delete_account"===t||"set_active_account"===t?o={idx:n[0]}:"save_yaml"===t?o={filename:n[0],content:n[1]}:"load_yaml"===t?o={filename:n[0]}:"check_resource_exists"===t?o={resourcePath:n[0]}:"save_config_volume"===t?o={data:JSON.stringify(n[0])}:"get_config_volume"===t?o={targetAccount:n[0]}:"save_report_faction_filter"===t?o={faction:n[0],targetAccount:n[1]}:"get_report_faction_filter"===t?o={targetAccount:n[0]}:"log_message"===t?o={message:n[0]}:"perform_update"===t&&(o={url:n[0],filename:n[1]}),window.isUnloading)return console.warn(`[Tauri Bridge] Skipping ${t} because app is unloading`),null;return await e(t,o)}catch(e){return window.isUnloading||console.error(`Error invoking ${t}:`,e),null}}}),console.log("Tauri Bridge initialized"),window.dispatchEvent(new Event("pywebviewready"))},382:(e,t,n)=>{"use strict";function o(e){return null==e}n.r(t),n.d(t,{CORE_SCHEMA:()=>at,DEFAULT_SCHEMA:()=>lt,FAILSAFE_SCHEMA:()=>it,JSON_SCHEMA:()=>rt,Schema:()=>ot,Type:()=>nt,YAMLException:()=>ut,default:()=>mt,dump:()=>dt,load:()=>st,loadAll:()=>ct,safeDump:()=>gt,safeLoad:()=>ft,safeLoadAll:()=>wt,types:()=>pt});var i={isNothing:o,isObject:function(e){return"object"==typeof e&&null!==e},toArray:function(e){return Array.isArray(e)?e:o(e)?[]:[e]},repeat:function(e,t){var n,o="";for(n=0;n<t;n+=1)o+=e;return o},isNegativeZero:function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},extend:function(e,t){var n,o,i,r;if(t)for(n=0,o=(r=Object.keys(t)).length;n<o;n+=1)e[i=r[n]]=t[i];return e}};function r(e,t){var n="",o=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!t&&e.mark.snippet&&(n+="\n\n"+e.mark.snippet),o+" "+n):o}function a(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=r(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a.prototype.toString=function(e){return this.name+": "+r(this,e)};var l=a;function s(e,t,n,o,i){var r="",a="",l=Math.floor(i/2)-1;return o-t>l&&(t=o-l+(r=" ... ").length),n-o>l&&(n=o+l-(a=" ...").length),{str:r+e.slice(t,n).replace(/\t/g,"â†’")+a,pos:o-t+r.length}}function c(e,t){return i.repeat(" ",t-e.length)+e}var d=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],u=["scalar","sequence","mapping"],p=function(e,t){if(t=t||{},Object.keys(t).forEach(function(t){if(-1===d.indexOf(t))throw new l('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')}),this.options=t,this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.representName=t.representName||null,this.defaultStyle=t.defaultStyle||null,this.multi=t.multi||!1,this.styleAliases=function(e){var t={};return null!==e&&Object.keys(e).forEach(function(n){e[n].forEach(function(e){t[String(e)]=n})}),t}(t.styleAliases||null),-1===u.indexOf(this.kind))throw new l('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')};function f(e,t){var n=[];return e[t].forEach(function(e){var t=n.length;n.forEach(function(n,o){n.tag===e.tag&&n.kind===e.kind&&n.multi===e.multi&&(t=o)}),n[t]=e}),n}function w(e){return this.extend(e)}w.prototype.extend=function(e){var t=[],n=[];if(e instanceof p)n.push(e);else if(Array.isArray(e))n=n.concat(e);else{if(!e||!Array.isArray(e.implicit)&&!Array.isArray(e.explicit))throw new l("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(n=n.concat(e.explicit))}t.forEach(function(e){if(!(e instanceof p))throw new l("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(e.loadKind&&"scalar"!==e.loadKind)throw new l("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(e.multi)throw new l("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),n.forEach(function(e){if(!(e instanceof p))throw new l("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var o=Object.create(w.prototype);return o.implicit=(this.implicit||[]).concat(t),o.explicit=(this.explicit||[]).concat(n),o.compiledImplicit=f(o,"implicit"),o.compiledExplicit=f(o,"explicit"),o.compiledTypeMap=function(){var e,t,n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function o(e){e.multi?(n.multi[e.kind].push(e),n.multi.fallback.push(e)):n[e.kind][e.tag]=n.fallback[e.tag]=e}for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(o);return n}(o.compiledImplicit,o.compiledExplicit),o};var g=w,m=new p("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}}),y=new p("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}}),h=new p("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}}),b=new g({explicit:[m,y,h]}),v=new p("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"}),x=new p("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function _(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function k(e){return 48<=e&&e<=55}function E(e){return 48<=e&&e<=57}var C=new p("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n=e.length,o=0,i=!1;if(!n)return!1;if("-"!==(t=e[o])&&"+"!==t||(t=e[++o]),"0"===t){if(o+1===n)return!0;if("b"===(t=e[++o])){for(o++;o<n;o++)if("_"!==(t=e[o])){if("0"!==t&&"1"!==t)return!1;i=!0}return i&&"_"!==t}if("x"===t){for(o++;o<n;o++)if("_"!==(t=e[o])){if(!_(e.charCodeAt(o)))return!1;i=!0}return i&&"_"!==t}if("o"===t){for(o++;o<n;o++)if("_"!==(t=e[o])){if(!k(e.charCodeAt(o)))return!1;i=!0}return i&&"_"!==t}}if("_"===t)return!1;for(;o<n;o++)if("_"!==(t=e[o])){if(!E(e.charCodeAt(o)))return!1;i=!0}return!(!i||"_"===t)},construct:function(e){var t,n=e,o=1;if(-1!==n.indexOf("_")&&(n=n.replace(/_/g,"")),"-"!==(t=n[0])&&"+"!==t||("-"===t&&(o=-1),t=(n=n.slice(1))[0]),"0"===n)return 0;if("0"===t){if("b"===n[1])return o*parseInt(n.slice(2),2);if("x"===n[1])return o*parseInt(n.slice(2),16);if("o"===n[1])return o*parseInt(n.slice(2),8)}return o*parseInt(n,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!i.isNegativeZero(e)},represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),I=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),S=/^[-+]?[0-9]+e/,A=new p("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!(!I.test(e)||"_"===e[e.length-1])},construct:function(e){var t,n;return n="-"===(t=e.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:n*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||i.isNegativeZero(e))},represent:function(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(i.isNegativeZero(e))return"-0.0";return n=e.toString(10),S.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"}),M=b.extend({implicit:[v,x,C,A]}),L=M,T=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),F=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$"),B=new p("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&(null!==T.exec(e)||null!==F.exec(e))},construct:function(e){var t,n,o,i,r,a,l,s,c=0,d=null;if(null===(t=T.exec(e))&&(t=F.exec(e)),null===t)throw new Error("Date resolve error");if(n=+t[1],o=+t[2]-1,i=+t[3],!t[4])return new Date(Date.UTC(n,o,i));if(r=+t[4],a=+t[5],l=+t[6],t[7]){for(c=t[7].slice(0,3);c.length<3;)c+="0";c=+c}return t[9]&&(d=6e4*(60*+t[10]+ +(t[11]||0)),"-"===t[9]&&(d=-d)),s=new Date(Date.UTC(n,o,i,r,a,l,c)),d&&s.setTime(s.getTime()-d),s},instanceOf:Date,represent:function(e){return e.toISOString()}}),N=new p("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}}),O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r",$=new p("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,o=0,i=e.length,r=O;for(n=0;n<i;n++)if(!((t=r.indexOf(e.charAt(n)))>64)){if(t<0)return!1;o+=6}return o%8==0},construct:function(e){var t,n,o=e.replace(/[\r\n=]/g,""),i=o.length,r=O,a=0,l=[];for(t=0;t<i;t++)t%4==0&&t&&(l.push(a>>16&255),l.push(a>>8&255),l.push(255&a)),a=a<<6|r.indexOf(o.charAt(t));return 0==(n=i%4*6)?(l.push(a>>16&255),l.push(a>>8&255),l.push(255&a)):18===n?(l.push(a>>10&255),l.push(a>>2&255)):12===n&&l.push(a>>4&255),new Uint8Array(l)},predicate:function(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)},represent:function(e){var t,n,o="",i=0,r=e.length,a=O;for(t=0;t<r;t++)t%3==0&&t&&(o+=a[i>>18&63],o+=a[i>>12&63],o+=a[i>>6&63],o+=a[63&i]),i=(i<<8)+e[t];return 0==(n=r%3)?(o+=a[i>>18&63],o+=a[i>>12&63],o+=a[i>>6&63],o+=a[63&i]):2===n?(o+=a[i>>10&63],o+=a[i>>4&63],o+=a[i<<2&63],o+=a[64]):1===n&&(o+=a[i>>2&63],o+=a[i<<4&63],o+=a[64],o+=a[64]),o}}),D=Object.prototype.hasOwnProperty,z=Object.prototype.toString,j=new p("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,o,i,r,a=[],l=e;for(t=0,n=l.length;t<n;t+=1){if(o=l[t],r=!1,"[object Object]"!==z.call(o))return!1;for(i in o)if(D.call(o,i)){if(r)return!1;r=!0}if(!r)return!1;if(-1!==a.indexOf(i))return!1;a.push(i)}return!0},construct:function(e){return null!==e?e:[]}}),P=Object.prototype.toString,R=new p("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,o,i,r,a=e;for(r=new Array(a.length),t=0,n=a.length;t<n;t+=1){if(o=a[t],"[object Object]"!==P.call(o))return!1;if(1!==(i=Object.keys(o)).length)return!1;r[t]=[i[0],o[i[0]]]}return!0},construct:function(e){if(null===e)return[];var t,n,o,i,r,a=e;for(r=new Array(a.length),t=0,n=a.length;t<n;t+=1)o=a[t],i=Object.keys(o),r[t]=[i[0],o[i[0]]];return r}}),q=Object.prototype.hasOwnProperty,W=new p("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,n=e;for(t in n)if(q.call(n,t)&&null!==n[t])return!1;return!0},construct:function(e){return null!==e?e:{}}}),U=L.extend({implicit:[B,N],explicit:[$,j,R,W]}),H=Object.prototype.hasOwnProperty,G=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,V=/[\x85\u2028\u2029]/,Y=/[,\[\]\{\}]/,J=/^(?:!|!!|![a-z\-]+!)$/i,X=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function K(e){return Object.prototype.toString.call(e)}function Z(e){return 10===e||13===e}function Q(e){return 9===e||32===e}function ee(e){return 9===e||32===e||10===e||13===e}function te(e){return 44===e||91===e||93===e||123===e||125===e}function ne(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function oe(e){return 120===e?2:117===e?4:85===e?8:0}function ie(e){return 48<=e&&e<=57?e-48:-1}function re(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e||9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"Â…":95===e?"Â ":76===e?"\u2028":80===e?"\u2029":""}function ae(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}for(var le=new Array(256),se=new Array(256),ce=0;ce<256;ce++)le[ce]=re(ce)?1:0,se[ce]=re(ce);function de(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||U,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function ue(e,t){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=function(e,t){if(t=Object.create(t||null),!e.buffer)return null;t.maxLength||(t.maxLength=79),"number"!=typeof t.indent&&(t.indent=1),"number"!=typeof t.linesBefore&&(t.linesBefore=3),"number"!=typeof t.linesAfter&&(t.linesAfter=2);for(var n,o=/\r?\n|\r|\0/g,r=[0],a=[],l=-1;n=o.exec(e.buffer);)a.push(n.index),r.push(n.index+n[0].length),e.position<=n.index&&l<0&&(l=r.length-2);l<0&&(l=r.length-1);var d,u,p="",f=Math.min(e.line+t.linesAfter,a.length).toString().length,w=t.maxLength-(t.indent+f+3);for(d=1;d<=t.linesBefore&&!(l-d<0);d++)u=s(e.buffer,r[l-d],a[l-d],e.position-(r[l]-r[l-d]),w),p=i.repeat(" ",t.indent)+c((e.line-d+1).toString(),f)+" | "+u.str+"\n"+p;for(u=s(e.buffer,r[l],a[l],e.position,w),p+=i.repeat(" ",t.indent)+c((e.line+1).toString(),f)+" | "+u.str+"\n",p+=i.repeat("-",t.indent+f+3+u.pos)+"^\n",d=1;d<=t.linesAfter&&!(l+d>=a.length);d++)u=s(e.buffer,r[l+d],a[l+d],e.position-(r[l]-r[l+d]),w),p+=i.repeat(" ",t.indent)+c((e.line+d+1).toString(),f)+" | "+u.str+"\n";return p.replace(/\n$/,"")}(n),new l(t,n)}function pe(e,t){throw ue(e,t)}function fe(e,t){e.onWarning&&e.onWarning.call(null,ue(e,t))}var we={YAML:function(e,t,n){var o,i,r;null!==e.version&&pe(e,"duplication of %YAML directive"),1!==n.length&&pe(e,"YAML directive accepts exactly one argument"),null===(o=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&pe(e,"ill-formed argument of the YAML directive"),i=parseInt(o[1],10),r=parseInt(o[2],10),1!==i&&pe(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=r<2,1!==r&&2!==r&&fe(e,"unsupported YAML version of the document")},TAG:function(e,t,n){var o,i;2!==n.length&&pe(e,"TAG directive accepts exactly two arguments"),o=n[0],i=n[1],J.test(o)||pe(e,"ill-formed tag handle (first argument) of the TAG directive"),H.call(e.tagMap,o)&&pe(e,'there is a previously declared suffix for "'+o+'" tag handle'),X.test(i)||pe(e,"ill-formed tag prefix (second argument) of the TAG directive");try{i=decodeURIComponent(i)}catch(t){pe(e,"tag prefix is malformed: "+i)}e.tagMap[o]=i}};function ge(e,t,n,o){var i,r,a,l;if(t<n){if(l=e.input.slice(t,n),o)for(i=0,r=l.length;i<r;i+=1)9===(a=l.charCodeAt(i))||32<=a&&a<=1114111||pe(e,"expected valid JSON character");else G.test(l)&&pe(e,"the stream contains non-printable characters");e.result+=l}}function me(e,t,n,o){var r,a,l,s;for(i.isObject(n)||pe(e,"cannot merge mappings; the provided source object is unacceptable"),l=0,s=(r=Object.keys(n)).length;l<s;l+=1)a=r[l],H.call(t,a)||(t[a]=n[a],o[a]=!0)}function ye(e,t,n,o,i,r,a,l,s){var c,d;if(Array.isArray(i))for(c=0,d=(i=Array.prototype.slice.call(i)).length;c<d;c+=1)Array.isArray(i[c])&&pe(e,"nested arrays are not supported inside keys"),"object"==typeof i&&"[object Object]"===K(i[c])&&(i[c]="[object Object]");if("object"==typeof i&&"[object Object]"===K(i)&&(i="[object Object]"),i=String(i),null===t&&(t={}),"tag:yaml.org,2002:merge"===o)if(Array.isArray(r))for(c=0,d=r.length;c<d;c+=1)me(e,t,r[c],n);else me(e,t,r,n);else e.json||H.call(n,i)||!H.call(t,i)||(e.line=a||e.line,e.lineStart=l||e.lineStart,e.position=s||e.position,pe(e,"duplicated mapping key")),"__proto__"===i?Object.defineProperty(t,i,{configurable:!0,enumerable:!0,writable:!0,value:r}):t[i]=r,delete n[i];return t}function he(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):pe(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function be(e,t,n){for(var o=0,i=e.input.charCodeAt(e.position);0!==i;){for(;Q(i);)9===i&&-1===e.firstTabInLine&&(e.firstTabInLine=e.position),i=e.input.charCodeAt(++e.position);if(t&&35===i)do{i=e.input.charCodeAt(++e.position)}while(10!==i&&13!==i&&0!==i);if(!Z(i))break;for(he(e),i=e.input.charCodeAt(e.position),o++,e.lineIndent=0;32===i;)e.lineIndent++,i=e.input.charCodeAt(++e.position)}return-1!==n&&0!==o&&e.lineIndent<n&&fe(e,"deficient indentation"),o}function ve(e){var t,n=e.position;return!(45!==(t=e.input.charCodeAt(n))&&46!==t||t!==e.input.charCodeAt(n+1)||t!==e.input.charCodeAt(n+2)||(n+=3,0!==(t=e.input.charCodeAt(n))&&!ee(t)))}function xe(e,t){1===t?e.result+=" ":t>1&&(e.result+=i.repeat("\n",t-1))}function _e(e,t){var n,o,i=e.tag,r=e.anchor,a=[],l=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=a),o=e.input.charCodeAt(e.position);0!==o&&(-1!==e.firstTabInLine&&(e.position=e.firstTabInLine,pe(e,"tab characters must not be used in indentation")),45===o)&&ee(e.input.charCodeAt(e.position+1));)if(l=!0,e.position++,be(e,!0,-1)&&e.lineIndent<=t)a.push(null),o=e.input.charCodeAt(e.position);else if(n=e.line,Ce(e,t,3,!1,!0),a.push(e.result),be(e,!0,-1),o=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&0!==o)pe(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!l&&(e.tag=i,e.anchor=r,e.kind="sequence",e.result=a,!0)}function ke(e){var t,n,o,i,r=!1,a=!1;if(33!==(i=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&pe(e,"duplication of a tag property"),60===(i=e.input.charCodeAt(++e.position))?(r=!0,i=e.input.charCodeAt(++e.position)):33===i?(a=!0,n="!!",i=e.input.charCodeAt(++e.position)):n="!",t=e.position,r){do{i=e.input.charCodeAt(++e.position)}while(0!==i&&62!==i);e.position<e.length?(o=e.input.slice(t,e.position),i=e.input.charCodeAt(++e.position)):pe(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==i&&!ee(i);)33===i&&(a?pe(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),J.test(n)||pe(e,"named tag handle cannot contain such characters"),a=!0,t=e.position+1)),i=e.input.charCodeAt(++e.position);o=e.input.slice(t,e.position),Y.test(o)&&pe(e,"tag suffix cannot contain flow indicator characters")}o&&!X.test(o)&&pe(e,"tag name cannot contain such characters: "+o);try{o=decodeURIComponent(o)}catch(t){pe(e,"tag name is malformed: "+o)}return r?e.tag=o:H.call(e.tagMap,n)?e.tag=e.tagMap[n]+o:"!"===n?e.tag="!"+o:"!!"===n?e.tag="tag:yaml.org,2002:"+o:pe(e,'undeclared tag handle "'+n+'"'),!0}function Ee(e){var t,n;if(38!==(n=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&pe(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!ee(n)&&!te(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&pe(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function Ce(e,t,n,o,r){var a,l,s,c,d,u,p,f,w,g=1,m=!1,y=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,a=l=s=4===n||3===n,o&&be(e,!0,-1)&&(m=!0,e.lineIndent>t?g=1:e.lineIndent===t?g=0:e.lineIndent<t&&(g=-1)),1===g)for(;ke(e)||Ee(e);)be(e,!0,-1)?(m=!0,s=a,e.lineIndent>t?g=1:e.lineIndent===t?g=0:e.lineIndent<t&&(g=-1)):s=!1;if(s&&(s=m||r),1!==g&&4!==n||(f=1===n||2===n?t:t+1,w=e.position-e.lineStart,1===g?s&&(_e(e,w)||function(e,t,n){var o,i,r,a,l,s,c,d=e.tag,u=e.anchor,p={},f=Object.create(null),w=null,g=null,m=null,y=!1,h=!1;if(-1!==e.firstTabInLine)return!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=p),c=e.input.charCodeAt(e.position);0!==c;){if(y||-1===e.firstTabInLine||(e.position=e.firstTabInLine,pe(e,"tab characters must not be used in indentation")),o=e.input.charCodeAt(e.position+1),r=e.line,63!==c&&58!==c||!ee(o)){if(a=e.line,l=e.lineStart,s=e.position,!Ce(e,n,2,!1,!0))break;if(e.line===r){for(c=e.input.charCodeAt(e.position);Q(c);)c=e.input.charCodeAt(++e.position);if(58===c)ee(c=e.input.charCodeAt(++e.position))||pe(e,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(ye(e,p,f,w,g,null,a,l,s),w=g=m=null),h=!0,y=!1,i=!1,w=e.tag,g=e.result;else{if(!h)return e.tag=d,e.anchor=u,!0;pe(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!h)return e.tag=d,e.anchor=u,!0;pe(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===c?(y&&(ye(e,p,f,w,g,null,a,l,s),w=g=m=null),h=!0,y=!0,i=!0):y?(y=!1,i=!0):pe(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,c=o;if((e.line===r||e.lineIndent>t)&&(y&&(a=e.line,l=e.lineStart,s=e.position),Ce(e,t,4,!0,i)&&(y?g=e.result:m=e.result),y||(ye(e,p,f,w,g,m,a,l,s),w=g=m=null),be(e,!0,-1),c=e.input.charCodeAt(e.position)),(e.line===r||e.lineIndent>t)&&0!==c)pe(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return y&&ye(e,p,f,w,g,null,a,l,s),h&&(e.tag=d,e.anchor=u,e.kind="mapping",e.result=p),h}(e,w,f))||function(e,t){var n,o,i,r,a,l,s,c,d,u,p,f,w=!0,g=e.tag,m=e.anchor,y=Object.create(null);if(91===(f=e.input.charCodeAt(e.position)))a=93,c=!1,r=[];else{if(123!==f)return!1;a=125,c=!0,r={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=r),f=e.input.charCodeAt(++e.position);0!==f;){if(be(e,!0,t),(f=e.input.charCodeAt(e.position))===a)return e.position++,e.tag=g,e.anchor=m,e.kind=c?"mapping":"sequence",e.result=r,!0;w?44===f&&pe(e,"expected the node content, but found ','"):pe(e,"missed comma between flow collection entries"),p=null,l=s=!1,63===f&&ee(e.input.charCodeAt(e.position+1))&&(l=s=!0,e.position++,be(e,!0,t)),n=e.line,o=e.lineStart,i=e.position,Ce(e,t,1,!1,!0),u=e.tag,d=e.result,be(e,!0,t),f=e.input.charCodeAt(e.position),!s&&e.line!==n||58!==f||(l=!0,f=e.input.charCodeAt(++e.position),be(e,!0,t),Ce(e,t,1,!1,!0),p=e.result),c?ye(e,r,y,u,d,p,n,o,i):l?r.push(ye(e,null,y,u,d,p,n,o,i)):r.push(d),be(e,!0,t),44===(f=e.input.charCodeAt(e.position))?(w=!0,f=e.input.charCodeAt(++e.position)):w=!1}pe(e,"unexpected end of the stream within a flow collection")}(e,f)?y=!0:(l&&function(e,t){var n,o,r,a,l=1,s=!1,c=!1,d=t,u=0,p=!1;if(124===(a=e.input.charCodeAt(e.position)))o=!1;else{if(62!==a)return!1;o=!0}for(e.kind="scalar",e.result="";0!==a;)if(43===(a=e.input.charCodeAt(++e.position))||45===a)1===l?l=43===a?3:2:pe(e,"repeat of a chomping mode identifier");else{if(!((r=ie(a))>=0))break;0===r?pe(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):c?pe(e,"repeat of an indentation width identifier"):(d=t+r-1,c=!0)}if(Q(a)){do{a=e.input.charCodeAt(++e.position)}while(Q(a));if(35===a)do{a=e.input.charCodeAt(++e.position)}while(!Z(a)&&0!==a)}for(;0!==a;){for(he(e),e.lineIndent=0,a=e.input.charCodeAt(e.position);(!c||e.lineIndent<d)&&32===a;)e.lineIndent++,a=e.input.charCodeAt(++e.position);if(!c&&e.lineIndent>d&&(d=e.lineIndent),Z(a))u++;else{if(e.lineIndent<d){3===l?e.result+=i.repeat("\n",s?1+u:u):1===l&&s&&(e.result+="\n");break}for(o?Q(a)?(p=!0,e.result+=i.repeat("\n",s?1+u:u)):p?(p=!1,e.result+=i.repeat("\n",u+1)):0===u?s&&(e.result+=" "):e.result+=i.repeat("\n",u):e.result+=i.repeat("\n",s?1+u:u),s=!0,c=!0,u=0,n=e.position;!Z(a)&&0!==a;)a=e.input.charCodeAt(++e.position);ge(e,n,e.position,!1)}}return!0}(e,f)||function(e,t){var n,o,i;if(39!==(n=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,o=i=e.position;0!==(n=e.input.charCodeAt(e.position));)if(39===n){if(ge(e,o,e.position,!0),39!==(n=e.input.charCodeAt(++e.position)))return!0;o=e.position,e.position++,i=e.position}else Z(n)?(ge(e,o,i,!0),xe(e,be(e,!1,t)),o=i=e.position):e.position===e.lineStart&&ve(e)?pe(e,"unexpected end of the document within a single quoted scalar"):(e.position++,i=e.position);pe(e,"unexpected end of the stream within a single quoted scalar")}(e,f)||function(e,t){var n,o,i,r,a,l;if(34!==(l=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,n=o=e.position;0!==(l=e.input.charCodeAt(e.position));){if(34===l)return ge(e,n,e.position,!0),e.position++,!0;if(92===l){if(ge(e,n,e.position,!0),Z(l=e.input.charCodeAt(++e.position)))be(e,!1,t);else if(l<256&&le[l])e.result+=se[l],e.position++;else if((a=oe(l))>0){for(i=a,r=0;i>0;i--)(a=ne(l=e.input.charCodeAt(++e.position)))>=0?r=(r<<4)+a:pe(e,"expected hexadecimal character");e.result+=ae(r),e.position++}else pe(e,"unknown escape sequence");n=o=e.position}else Z(l)?(ge(e,n,o,!0),xe(e,be(e,!1,t)),n=o=e.position):e.position===e.lineStart&&ve(e)?pe(e,"unexpected end of the document within a double quoted scalar"):(e.position++,o=e.position)}pe(e,"unexpected end of the stream within a double quoted scalar")}(e,f)?y=!0:function(e){var t,n,o;if(42!==(o=e.input.charCodeAt(e.position)))return!1;for(o=e.input.charCodeAt(++e.position),t=e.position;0!==o&&!ee(o)&&!te(o);)o=e.input.charCodeAt(++e.position);return e.position===t&&pe(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),H.call(e.anchorMap,n)||pe(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],be(e,!0,-1),!0}(e)?(y=!0,null===e.tag&&null===e.anchor||pe(e,"alias node should not have any properties")):function(e,t,n){var o,i,r,a,l,s,c,d,u=e.kind,p=e.result;if(ee(d=e.input.charCodeAt(e.position))||te(d)||35===d||38===d||42===d||33===d||124===d||62===d||39===d||34===d||37===d||64===d||96===d)return!1;if((63===d||45===d)&&(ee(o=e.input.charCodeAt(e.position+1))||n&&te(o)))return!1;for(e.kind="scalar",e.result="",i=r=e.position,a=!1;0!==d;){if(58===d){if(ee(o=e.input.charCodeAt(e.position+1))||n&&te(o))break}else if(35===d){if(ee(e.input.charCodeAt(e.position-1)))break}else{if(e.position===e.lineStart&&ve(e)||n&&te(d))break;if(Z(d)){if(l=e.line,s=e.lineStart,c=e.lineIndent,be(e,!1,-1),e.lineIndent>=t){a=!0,d=e.input.charCodeAt(e.position);continue}e.position=r,e.line=l,e.lineStart=s,e.lineIndent=c;break}}a&&(ge(e,i,r,!1),xe(e,e.line-l),i=r=e.position,a=!1),Q(d)||(r=e.position+1),d=e.input.charCodeAt(++e.position)}return ge(e,i,r,!1),!!e.result||(e.kind=u,e.result=p,!1)}(e,f,1===n)&&(y=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===g&&(y=s&&_e(e,w))),null===e.tag)null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);else if("?"===e.tag){for(null!==e.result&&"scalar"!==e.kind&&pe(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),c=0,d=e.implicitTypes.length;c<d;c+=1)if((p=e.implicitTypes[c]).resolve(e.result)){e.result=p.construct(e.result),e.tag=p.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else if("!"!==e.tag){if(H.call(e.typeMap[e.kind||"fallback"],e.tag))p=e.typeMap[e.kind||"fallback"][e.tag];else for(p=null,c=0,d=(u=e.typeMap.multi[e.kind||"fallback"]).length;c<d;c+=1)if(e.tag.slice(0,u[c].tag.length)===u[c].tag){p=u[c];break}p||pe(e,"unknown tag !<"+e.tag+">"),null!==e.result&&p.kind!==e.kind&&pe(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+p.kind+'", not "'+e.kind+'"'),p.resolve(e.result,e.tag)?(e.result=p.construct(e.result,e.tag),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):pe(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||y}function Ie(e){var t,n,o,i,r=e.position,a=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);0!==(i=e.input.charCodeAt(e.position))&&(be(e,!0,-1),i=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==i));){for(a=!0,i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!ee(i);)i=e.input.charCodeAt(++e.position);for(o=[],(n=e.input.slice(t,e.position)).length<1&&pe(e,"directive name must not be less than one character in length");0!==i;){for(;Q(i);)i=e.input.charCodeAt(++e.position);if(35===i){do{i=e.input.charCodeAt(++e.position)}while(0!==i&&!Z(i));break}if(Z(i))break;for(t=e.position;0!==i&&!ee(i);)i=e.input.charCodeAt(++e.position);o.push(e.input.slice(t,e.position))}0!==i&&he(e),H.call(we,n)?we[n](e,n,o):fe(e,'unknown document directive "'+n+'"')}be(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,be(e,!0,-1)):a&&pe(e,"directives end mark is expected"),Ce(e,e.lineIndent-1,4,!1,!0),be(e,!0,-1),e.checkLineBreaks&&V.test(e.input.slice(r,e.position))&&fe(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&ve(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,be(e,!0,-1)):e.position<e.length-1&&pe(e,"end of the stream or a document separator is expected")}function Se(e,t){t=t||{},0!==(e=String(e)).length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var n=new de(e,t),o=e.indexOf("\0");for(-1!==o&&(n.position=o,pe(n,"null byte is not allowed in input")),n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)Ie(n);return n.documents}var Ae=function(e,t,n){null!==t&&"object"==typeof t&&void 0===n&&(n=t,t=null);var o=Se(e,n);if("function"!=typeof t)return o;for(var i=0,r=o.length;i<r;i+=1)t(o[i])},Me=function(e,t){var n=Se(e,t);if(0!==n.length){if(1===n.length)return n[0];throw new l("expected a single document in the stream, but found more")}},Le=Object.prototype.toString,Te=Object.prototype.hasOwnProperty,Fe=65279,Be={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},Ne=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Oe=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function $e(e){var t,n,o;if(t=e.toString(16).toUpperCase(),e<=255)n="x",o=2;else if(e<=65535)n="u",o=4;else{if(!(e<=4294967295))throw new l("code point within a string may not be greater than 0xFFFFFFFF");n="U",o=8}return"\\"+n+i.repeat("0",o-t.length)+t}function De(e){this.schema=e.schema||U,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=i.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=function(e,t){var n,o,i,r,a,l,s;if(null===t)return{};for(n={},i=0,r=(o=Object.keys(t)).length;i<r;i+=1)a=o[i],l=String(t[a]),"!!"===a.slice(0,2)&&(a="tag:yaml.org,2002:"+a.slice(2)),(s=e.compiledTypeMap.fallback[a])&&Te.call(s.styleAliases,l)&&(l=s.styleAliases[l]),n[a]=l;return n}(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType='"'===e.quotingType?2:1,this.forceQuotes=e.forceQuotes||!1,this.replacer="function"==typeof e.replacer?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function ze(e,t){for(var n,o=i.repeat(" ",t),r=0,a=-1,l="",s=e.length;r<s;)-1===(a=e.indexOf("\n",r))?(n=e.slice(r),r=s):(n=e.slice(r,a+1),r=a+1),n.length&&"\n"!==n&&(l+=o),l+=n;return l}function je(e,t){return"\n"+i.repeat(" ",e.indent*t)}function Pe(e){return 32===e||9===e}function Re(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&e!==Fe||65536<=e&&e<=1114111}function qe(e){return Re(e)&&e!==Fe&&13!==e&&10!==e}function We(e,t,n){var o=qe(e),i=o&&!Pe(e);return(n?o:o&&44!==e&&91!==e&&93!==e&&123!==e&&125!==e)&&35!==e&&!(58===t&&!i)||qe(t)&&!Pe(t)&&35===e||58===t&&i}function Ue(e,t){var n,o=e.charCodeAt(t);return o>=55296&&o<=56319&&t+1<e.length&&(n=e.charCodeAt(t+1))>=56320&&n<=57343?1024*(o-55296)+n-56320+65536:o}function He(e){return/^\n* /.test(e)}function Ge(e,t,n,o,i){e.dump=function(){if(0===t.length)return 2===e.quotingType?'""':"''";if(!e.noCompatMode&&(-1!==Ne.indexOf(t)||Oe.test(t)))return 2===e.quotingType?'"'+t+'"':"'"+t+"'";var r=e.indent*Math.max(1,n),a=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-r),s=o||e.flowLevel>-1&&n>=e.flowLevel;switch(function(e,t,n,o,i,r,a,l){var s,c,d=0,u=null,p=!1,f=!1,w=-1!==o,g=-1,m=Re(c=Ue(e,0))&&c!==Fe&&!Pe(c)&&45!==c&&63!==c&&58!==c&&44!==c&&91!==c&&93!==c&&123!==c&&125!==c&&35!==c&&38!==c&&42!==c&&33!==c&&124!==c&&61!==c&&62!==c&&39!==c&&34!==c&&37!==c&&64!==c&&96!==c&&function(e){return!Pe(e)&&58!==e}(Ue(e,e.length-1));if(t||a)for(s=0;s<e.length;d>=65536?s+=2:s++){if(!Re(d=Ue(e,s)))return 5;m=m&&We(d,u,l),u=d}else{for(s=0;s<e.length;d>=65536?s+=2:s++){if(10===(d=Ue(e,s)))p=!0,w&&(f=f||s-g-1>o&&" "!==e[g+1],g=s);else if(!Re(d))return 5;m=m&&We(d,u,l),u=d}f=f||w&&s-g-1>o&&" "!==e[g+1]}return p||f?n>9&&He(e)?5:a?2===r?5:2:f?4:3:!m||a||i(e)?2===r?5:2:1}(t,s,e.indent,a,function(t){return function(e,t){var n,o;for(n=0,o=e.implicitTypes.length;n<o;n+=1)if(e.implicitTypes[n].resolve(t))return!0;return!1}(e,t)},e.quotingType,e.forceQuotes&&!o,i)){case 1:return t;case 2:return"'"+t.replace(/'/g,"''")+"'";case 3:return"|"+Ve(t,e.indent)+Ye(ze(t,r));case 4:return">"+Ve(t,e.indent)+Ye(ze(function(e,t){for(var n,o,i,r=/(\n+)([^\n]*)/g,a=(i=-1!==(i=e.indexOf("\n"))?i:e.length,r.lastIndex=i,Je(e.slice(0,i),t)),l="\n"===e[0]||" "===e[0];o=r.exec(e);){var s=o[1],c=o[2];n=" "===c[0],a+=s+(l||n||""===c?"":"\n")+Je(c,t),l=n}return a}(t,a),r));case 5:return'"'+function(e){for(var t,n="",o=0,i=0;i<e.length;o>=65536?i+=2:i++)o=Ue(e,i),!(t=Be[o])&&Re(o)?(n+=e[i],o>=65536&&(n+=e[i+1])):n+=t||$e(o);return n}(t)+'"';default:throw new l("impossible error: invalid scalar style")}}()}function Ve(e,t){var n=He(e)?String(t):"",o="\n"===e[e.length-1];return n+(!o||"\n"!==e[e.length-2]&&"\n"!==e?o?"":"-":"+")+"\n"}function Ye(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function Je(e,t){if(""===e||" "===e[0])return e;for(var n,o,i=/ [^ ]/g,r=0,a=0,l=0,s="";n=i.exec(e);)(l=n.index)-r>t&&(o=a>r?a:l,s+="\n"+e.slice(r,o),r=o+1),a=l;return s+="\n",e.length-r>t&&a>r?s+=e.slice(r,a)+"\n"+e.slice(a+1):s+=e.slice(r),s.slice(1)}function Xe(e,t,n,o){var i,r,a,l="",s=e.tag;for(i=0,r=n.length;i<r;i+=1)a=n[i],e.replacer&&(a=e.replacer.call(n,String(i),a)),(Ze(e,t+1,a,!0,!0,!1,!0)||void 0===a&&Ze(e,t+1,null,!0,!0,!1,!0))&&(o&&""===l||(l+=je(e,t)),e.dump&&10===e.dump.charCodeAt(0)?l+="-":l+="- ",l+=e.dump);e.tag=s,e.dump=l||"[]"}function Ke(e,t,n){var o,i,r,a,s,c;for(r=0,a=(i=n?e.explicitTypes:e.implicitTypes).length;r<a;r+=1)if(((s=i[r]).instanceOf||s.predicate)&&(!s.instanceOf||"object"==typeof t&&t instanceof s.instanceOf)&&(!s.predicate||s.predicate(t))){if(n?s.multi&&s.representName?e.tag=s.representName(t):e.tag=s.tag:e.tag="?",s.represent){if(c=e.styleMap[s.tag]||s.defaultStyle,"[object Function]"===Le.call(s.represent))o=s.represent(t,c);else{if(!Te.call(s.represent,c))throw new l("!<"+s.tag+'> tag resolver accepts not "'+c+'" style');o=s.represent[c](t,c)}e.dump=o}return!0}return!1}function Ze(e,t,n,o,i,r,a){e.tag=null,e.dump=n,Ke(e,n,!1)||Ke(e,n,!0);var s,c=Le.call(e.dump),d=o;o&&(o=e.flowLevel<0||e.flowLevel>t);var u,p,f="[object Object]"===c||"[object Array]"===c;if(f&&(p=-1!==(u=e.duplicates.indexOf(n))),(null!==e.tag&&"?"!==e.tag||p||2!==e.indent&&t>0)&&(i=!1),p&&e.usedDuplicates[u])e.dump="*ref_"+u;else{if(f&&p&&!e.usedDuplicates[u]&&(e.usedDuplicates[u]=!0),"[object Object]"===c)o&&0!==Object.keys(e.dump).length?(function(e,t,n,o){var i,r,a,s,c,d,u="",p=e.tag,f=Object.keys(n);if(!0===e.sortKeys)f.sort();else if("function"==typeof e.sortKeys)f.sort(e.sortKeys);else if(e.sortKeys)throw new l("sortKeys must be a boolean or a function");for(i=0,r=f.length;i<r;i+=1)d="",o&&""===u||(d+=je(e,t)),s=n[a=f[i]],e.replacer&&(s=e.replacer.call(n,a,s)),Ze(e,t+1,a,!0,!0,!0)&&((c=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&10===e.dump.charCodeAt(0)?d+="?":d+="? "),d+=e.dump,c&&(d+=je(e,t)),Ze(e,t+1,s,!0,c)&&(e.dump&&10===e.dump.charCodeAt(0)?d+=":":d+=": ",u+=d+=e.dump));e.tag=p,e.dump=u||"{}"}(e,t,e.dump,i),p&&(e.dump="&ref_"+u+e.dump)):(function(e,t,n){var o,i,r,a,l,s="",c=e.tag,d=Object.keys(n);for(o=0,i=d.length;o<i;o+=1)l="",""!==s&&(l+=", "),e.condenseFlow&&(l+='"'),a=n[r=d[o]],e.replacer&&(a=e.replacer.call(n,r,a)),Ze(e,t,r,!1,!1)&&(e.dump.length>1024&&(l+="? "),l+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),Ze(e,t,a,!1,!1)&&(s+=l+=e.dump));e.tag=c,e.dump="{"+s+"}"}(e,t,e.dump),p&&(e.dump="&ref_"+u+" "+e.dump));else if("[object Array]"===c)o&&0!==e.dump.length?(e.noArrayIndent&&!a&&t>0?Xe(e,t-1,e.dump,i):Xe(e,t,e.dump,i),p&&(e.dump="&ref_"+u+e.dump)):(function(e,t,n){var o,i,r,a="",l=e.tag;for(o=0,i=n.length;o<i;o+=1)r=n[o],e.replacer&&(r=e.replacer.call(n,String(o),r)),(Ze(e,t,r,!1,!1)||void 0===r&&Ze(e,t,null,!1,!1))&&(""!==a&&(a+=","+(e.condenseFlow?"":" ")),a+=e.dump);e.tag=l,e.dump="["+a+"]"}(e,t,e.dump),p&&(e.dump="&ref_"+u+" "+e.dump));else{if("[object String]"!==c){if("[object Undefined]"===c)return!1;if(e.skipInvalid)return!1;throw new l("unacceptable kind of an object to dump "+c)}"?"!==e.tag&&Ge(e,e.dump,t,r,d)}null!==e.tag&&"?"!==e.tag&&(s=encodeURI("!"===e.tag[0]?e.tag.slice(1):e.tag).replace(/!/g,"%21"),s="!"===e.tag[0]?"!"+s:"tag:yaml.org,2002:"===s.slice(0,18)?"!!"+s.slice(18):"!<"+s+">",e.dump=s+" "+e.dump)}return!0}function Qe(e,t){var n,o,i=[],r=[];for(et(e,i,r),n=0,o=r.length;n<o;n+=1)t.duplicates.push(i[r[n]]);t.usedDuplicates=new Array(o)}function et(e,t,n){var o,i,r;if(null!==e&&"object"==typeof e)if(-1!==(i=t.indexOf(e)))-1===n.indexOf(i)&&n.push(i);else if(t.push(e),Array.isArray(e))for(i=0,r=e.length;i<r;i+=1)et(e[i],t,n);else for(i=0,r=(o=Object.keys(e)).length;i<r;i+=1)et(e[o[i]],t,n)}function tt(e,t){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+t+" instead, which is now safe by default.")}}var nt=p,ot=g,it=b,rt=M,at=L,lt=U,st=Me,ct=Ae,dt=function(e,t){var n=new De(t=t||{});n.noRefs||Qe(e,n);var o=e;return n.replacer&&(o=n.replacer.call({"":o},"",o)),Ze(n,0,o,!0,!0)?n.dump+"\n":""},ut=l,pt={binary:$,float:A,map:h,null:v,pairs:R,set:W,timestamp:B,bool:x,int:C,merge:N,omap:j,seq:y,str:m},ft=tt("safeLoad","load"),wt=tt("safeLoadAll","loadAll"),gt=tt("safeDump","dump");const mt={Type:nt,Schema:ot,FAILSAFE_SCHEMA:it,JSON_SCHEMA:rt,CORE_SCHEMA:at,DEFAULT_SCHEMA:lt,load:st,loadAll:ct,dump:dt,YAMLException:ut,types:pt,safeLoad:ft,safeLoadAll:wt,safeDump:gt}},415:(e,t,n)=>{"use strict";n.d(t,{showDetailDialog:()=>a,showEditDialog:()=>r});var o=n(191);function i(e){return{è’™å¤:"rgb(0, 138, 247)",è‡ºç£:"rgb(6, 133, 158)",æ»¿æ´²:"rgb(252, 185, 0)",é¦™æ¸¯:"rgb(174, 67, 236)",åè³Šè¯ç›Ÿ:"rgb(255, 255, 255)",è—åœ‹:"rgb(70, 190, 127)",ç¶­å¾çˆ¾:"rgb(116, 160, 246)",å“ˆè–©å…‹:"rgb(0, 233, 228)",ç´…è»:"rgb(253, 30, 25)",æ–°ä¸­åœ‹ç‹‚æ­¡:"rgb(109, 109, 109)"}[e]||"rgb(109,109,109)"}function r(e,t){const n=(0,o.getMarkerId)(e),i=e.style.backgroundColor,r=(0,o.J7)(i),a=t[n]||{cityName:"",id:"",npc:[],reward:[],sovereignty:"",airport:"",port:""},l=Array.from(new Set((0,o.ph)(t,"npc"))),s=Array.from(new Set((0,o._r)(t))),c=Array.from(new Set((0,o.ph)(t,"sovereignty"))),d=Array.from(new Set((0,o.ph)(t,"airport"))),u=Array.from(new Set((0,o.ph)(t,"port")));let p='<div style="font-size:1.3em;font-weight:bold;margin-bottom:18px;letter-spacing:1px;">ç·¨è¼¯æ“šé»žè³‡è¨Š</div>';p+='<div style="display:flex;flex-direction:column;gap:14px;">',p+=`<label style="font-size:1em;">åŸŽå¸‚åç¨±ï¼š<input id="edit-cityName" value="${a.cityName||""}" placeholder="å¯ç•™ç©º" style="width:100%;padding:7px 10px;border-radius:6px;border:1.5px solid #888;background:#222;color:#fff;font-size:1em;"></label>`,p+=`<label style="font-size:1em;">IDï¼š<input id="edit-id" value="${a.id||""}" placeholder="å¯ç•™ç©º" style="width:100%;padding:7px 10px;border-radius:6px;border:1.5px solid #888;background:#222;color:#fff;font-size:1em;"></label>`,p+=`<label style="font-size:1em;">NPCæ”¯æ´ï¼ˆå¤šé …ä»¥,åˆ†éš”ï¼‰ï¼š<input id="edit-npc" value="${(a.npc||[]).join(",")}" style="width:70%;padding:7px 10px;border-radius:6px;border:1.5px solid #888;background:#222;color:#fff;font-size:1em;">`,l.length&&(p+='<select id="npc-select" style="margin-left:8px;padding:7px 10px;border-radius:6px;background:#222;color:#fff;">',p+='<option value="">å¿«é€Ÿé¸æ“‡</option>',l.forEach(e=>{p+=`<option value="${e}">${e}</option>`}),p+="</select>"),p+="</label>",p+=`<label style="font-size:1em;">ä½”é ˜çŽå‹µï¼ˆå¤šé …ä»¥,åˆ†éš”ï¼‰ï¼š<input id="edit-reward" value="${(a.reward||[]).join(",")}" style="width:70%;padding:7px 10px;border-radius:6px;border:1.5px solid #888;background:#222;color:#fff;font-size:1em;">`,s.length&&(p+='<select id="reward-select" style="margin-left:8px;padding:7px 10px;border-radius:6px;background:#222;color:#fff;">',p+='<option value="">å¿«é€Ÿé¸æ“‡çµ„åˆ</option>',s.forEach(e=>{p+=`<option value="${e}">${e}</option>`}),p+="</select>"),p+="</label>",p+=`<label style="font-size:1em;">ä¸»æ¬Šï¼š<input id="edit-sovereignty" value="${a.sovereignty||""}" style="width:70%;padding:7px 10px;border-radius:6px;border:1.5px solid #888;background:#222;color:#fff;font-size:1em;">`,c.length&&(p+='<select id="sovereignty-select" style="margin-left:8px;padding:7px 10px;border-radius:6px;background:#222;color:#fff;">',p+='<option value="">å¿«é€Ÿé¸æ“‡</option>',c.forEach(e=>{p+=`<option value="${e}">${e}</option>`}),p+="</select>"),p+="</label>",p+=`<label style="font-size:1em;">æ©Ÿå ´å‰å¾€ï¼š<input id="edit-airport" value="${a.airport||""}" style="width:70%;padding:7px 10px;border-radius:6px;border:1.5px solid #888;background:#222;color:#fff;font-size:1em;">`,d.length&&(p+='<select id="airport-select" style="margin-left:8px;padding:7px 10px;border-radius:6px;background:#222;color:#fff;">',p+='<option value="">å¿«é€Ÿé¸æ“‡</option>',d.forEach(e=>{p+=`<option value="${e}">${e}</option>`}),p+="</select>"),p+="</label>",p+=`<label style="font-size:1em;">æ¸¯å£å‰å¾€ï¼š<input id="edit-port" value="${a.port||""}" style="width:70%;padding:7px 10px;border-radius:6px;border:1.5px solid #888;background:#222;color:#fff;font-size:1em;">`,u.length&&(p+='<select id="port-select" style="margin-left:8px;padding:7px 10px;border-radius:6px;background:#222;color:#fff;">',p+='<option value="">å¿«é€Ÿé¸æ“‡</option>',u.forEach(e=>{p+=`<option value="${e}">${e}</option>`}),p+="</select>"),p+="</label>",p+=`<label style="font-size:1em;">æŽ§åˆ¶ï¼š<input value="${r}" disabled style="width:100%;padding:7px 10px;border-radius:6px;border:1.5px solid #888;background:#333;color:#fff;font-size:1em;"></label>`,p+="</div>",p+='<div style="display:flex;gap:18px;justify-content:center;margin-top:28px;"><button id="save-marker-data" style="background:#2a7cff;color:#fff;border:none;padding:10px 32px;border-radius:8px;font-size:1.1em;cursor:pointer;font-weight:bold;letter-spacing:2px;">å„²å­˜</button><button id="close-marker-dialog" style="background:#444;color:#fff;border:none;padding:10px 32px;border-radius:8px;font-size:1.1em;cursor:pointer;font-weight:bold;letter-spacing:2px;">é—œé–‰</button></div>';let f=document.getElementById("marker-edit-dialog");if(f||(f=document.createElement("div"),f.id="marker-edit-dialog",f.tabIndex=0,f.style.position="fixed",f.style.left="50%",f.style.top="50%",f.style.transform="translate(-50%,-50%)",f.style.background="rgba(30,30,30,0.98)",f.style.color="#fff",f.style.width="min(420px, 65vw)",f.style.maxWidth="65vw",f.style.minWidth="220px",f.style.maxHeight="88vh",f.style.overflow="auto",f.style.padding="32px 20px 20px 20px",f.style.borderRadius="18px",f.style.zIndex=1e5,f.style.boxShadow="0 8px 48px #000c",f.style.outline="none",document.body.appendChild(f)),f.innerHTML=p,f.style.display="block",f.focus(),document.getElementById("close-marker-dialog").onclick=()=>f.style.display="none",setTimeout(()=>{document.addEventListener("mousedown",function e(t){"block"===f.style.display&&(f.contains(t.target)||(f.style.display="none",document.removeEventListener("mousedown",e)))})},0),l.length){const e=document.getElementById("npc-select");e&&(e.onchange=function(){if(this.value){let e=document.getElementById("edit-npc").value;e&&!e.endsWith(",")&&(e+=","),document.getElementById("edit-npc").value=e+this.value,this.value=""}})}if(s.length){const e=document.getElementById("reward-select");e&&(e.onchange=function(){this.value&&(document.getElementById("edit-reward").value=this.value,this.value="")})}if(c.length){const e=document.getElementById("sovereignty-select");e&&(e.onchange=function(){this.value&&(document.getElementById("edit-sovereignty").value=this.value,this.value="")})}if(d.length){const e=document.getElementById("airport-select");e&&(e.onchange=function(){this.value&&(document.getElementById("edit-airport").value=this.value,this.value="")})}if(u.length){const e=document.getElementById("port-select");e&&(e.onchange=function(){this.value&&(document.getElementById("edit-port").value=this.value,this.value="")})}document.getElementById("save-marker-data").onclick=async()=>{t[n]={cityName:document.getElementById("edit-cityName").value,id:document.getElementById("edit-id").value,npc:document.getElementById("edit-npc").value.split(",").map(e=>e.trim()).filter(Boolean),reward:document.getElementById("edit-reward").value.split(",").map(e=>e.trim()).filter(Boolean),sovereignty:document.getElementById("edit-sovereignty").value,airport:document.getElementById("edit-airport").value,port:document.getElementById("edit-port").value},window.saveMarkerDataToYaml&&await window.saveMarkerDataToYaml(t),f.style.display="none"}}function a(e,t){if(!location.hash.startsWith("#/portalmap"))return;const n=(0,o.getMarkerId)(e),r=e.style.backgroundColor,a=t[n]||{cityName:(0,o.getCityName)(e),id:n,npc:[],reward:[],sovereignty:"",airport:"",port:""},l=(0,o.J7)(r),s=i(l),c="åè³Šè¯ç›Ÿ"===l;let d=`<div style='font-size:1.45em;font-weight:700;margin-bottom:16px;letter-spacing:1px;text-align:center;'>${a.cityName||""} <span style='font-size:0.9em;font-weight:normal;color:#eee;'>(ID: ${a.id||""})</span></div>`;d+="<hr style='border:none;border-top:2px solid #fff5;margin:0 0 18px 0;'>",d+=`<div style='display:flex;gap:18px;margin-bottom:10px;align-items:center;'><span style='font-weight:bold;font-size:1.15em;'>ä¸»æ¬Š</span><span style='background:#333;padding:4px 18px;border-radius:8px;font-size:1.1em;'>${a.sovereignty||""}</span></div>`,d+=`<div style='display:flex;gap:18px;align-items:center;'><span style='font-weight:bold;font-size:1.15em;'>æŽ§åˆ¶</span><span style='background:${s};color:${c?"#222":"#fff"};padding:4px 18px;border-radius:8px;font-size:1.1em;font-weight:bold;box-shadow:0 1px 6px #0003;'>${l}</span></div>`,d+="<hr style='border:none;border-top:2px solid #fff5;margin:18px 0 10px 0;'>",a.airport&&(d+=`<div style='display:flex;gap:18px;margin-bottom:10px;align-items:center;'><span style='font-weight:bold;font-size:1.15em;'>æ©Ÿå ´å‰å¾€</span><span style='background:#1dbf60;padding:4px 18px;border-radius:8px;font-size:1.1em;'>${a.airport}</span></div>`),a.port&&(d+=`<div style='display:flex;gap:18px;margin-bottom:10px;align-items:center;'><span style='font-weight:bold;font-size:1.15em;'>æ¸¯å£å‰å¾€</span><span style='background:#1dbf60;padding:4px 18px;border-radius:8px;font-size:1.1em;'>${a.port}</span></div>`),d+="<hr style='border:none;border-top:2px solid #fff5;margin:18px 0 10px 0;'>",a.npc&&a.npc.length&&(d+="<div style='font-weight:bold;font-size:1.15em;margin-bottom:8px;'>NPC æ”¯æ´</div>",d+="<div style='display:flex;gap:12px;margin-bottom:10px;'>",a.npc.forEach(e=>{const t=i(e);d+=`<span style='background:${t};color:${"åè³Šè¯ç›Ÿ"===e?"#222":"#fff"};padding:4px 16px;border-radius:8px;font-size:1.1em;font-weight:bold;'>${e}</span>`}),d+="</div>",d+="<hr style='border:none;border-top:2px solid #fff5;margin:18px 0 10px 0;'>"),a.reward&&a.reward.length&&(d+="<div style='font-weight:bold;font-size:1.15em;margin-bottom:8px;'>ä½”é ˜çŽå‹µ</div>",a.reward.forEach(e=>{let t=e.match(/^(.*?)(\((.*?)\))?:(\d+)/);if(t){const e=t[1].trim(),n=t[3]||"",o=t[4],i=function(e){if(!e)return"";const t=e[0],n=e[1],o={ç´…:"æ¸¸æ“ŠéšŠ",é»ƒ:"è³‡åŠ©å®¶",ç¶ :"é–“è«œ",è—:"å®£å‚³å®¶"}[t]||"";return o&&n?`${o}${n}ç´šç´ æ`:""}(n);d+="<div style='display:flex;align-items:center;gap:10px;padding:4px 0 4px 0;font-size:1.1em;'>",d+=`<span style='min-width:70px;'>${e}</span>`,d+=`<span style='font-weight:bold;color:#ffd700;min-width:36px;text-align:right;'>${o}</span>`,d+=i?`<span style='font-size:0.98em;color:#fff;opacity:0.85;'>ä¸¨${i}</span>`:"",d+="</div>"}else d+=`<div style='padding:4px 0;font-size:1.1em;'>${e}</div>`})),d+="<div style='display:flex;gap:18px;justify-content:center;margin-top:18px;'>",d+="</div>";let u=document.getElementById("marker-detail-dialog");u?(u.style.background=`${s}CC`,u.style.backdropFilter="blur(18px)",u.style.webkitBackdropFilter="blur(18px)",u.style.width="min(420px, 65vw)",u.style.maxWidth="65vw",u.style.minWidth="220px",u.style.maxHeight="88vh",u.style.overflow="auto"):(u=document.createElement("div"),u.id="marker-detail-dialog",u.tabIndex=0,u.style.position="fixed",u.style.left="50%",u.style.top="50%",u.style.transform="translate(-50%,-50%)",u.style.background=`${s}CC`,u.style.backdropFilter="blur(18px)",u.style.webkitBackdropFilter="blur(18px)",u.style.color="#fff",u.style.padding="0",u.style.borderRadius="22px",u.style.zIndex=1e5,u.style.boxShadow="0 8px 48px #000c",u.style.width="min(420px, 65vw)",u.style.maxWidth="65vw",u.style.minWidth="220px",u.style.maxHeight="88vh",u.style.overflow="auto",u.style.outline="none",document.body.appendChild(u)),u.innerHTML=`<div style='padding:20px 16px 14px 16px;'>${d}</div>`,u.style.display="block",u.focus(),setTimeout(()=>{document.addEventListener("mousedown",function e(t){"block"===u.style.display&&(u.contains(t.target)||(u.style.display="none",document.removeEventListener("mousedown",e)))})},0),window.addEventListener("hashchange",function e(){location.hash.startsWith("#/portalmap")||(u.style.display="none",window.removeEventListener("hashchange",e))});let p=!1,f=0,w=0,g=0,m=0;u.onmousedown=function(e){if("BUTTON"===e.target.tagName)return;p=!0,f=e.clientX,w=e.clientY;const t=u.getBoundingClientRect();g=t.left,m=t.top,u.style.transition="none",document.body.style.userSelect="none"},window.onmousemove=function(e){if(!p)return;let t=e.clientX-f,n=e.clientY-w,o=g+t,i=m+n;const r=u.getBoundingClientRect(),a=window.innerWidth,l=window.innerHeight,s=a-r.width-8,c=l-r.height-8;o<8&&(o=8),i<8&&(i=8),o>s&&(o=s),i>c&&(i=c),u.style.left=o+"px",u.style.top=i+"px",u.style.transform="none"},window.onmouseup=function(){p=!1,document.body.style.userSelect=""}}},435:(e,t,n)=>{"use strict";n.d(t,{clearConnectionLines:()=>s,drawConnectionLinesOptimized:()=>l,resetCityToMarkerCache:()=>c});var o=n(191);let i=null,r="";function a(e,t){const n=[t,t.trim(),t.trim().toLowerCase(),t.replace(/\s+/g,""),t.trim().replace(/\s+/g,""),t.trim().replace(/\s+/g,"").toLowerCase()];for(const t of n)if(e[t])return e[t];return console.warn("[RF DEBUG] æ‰¾ä¸åˆ°èˆªç·šç›®æ¨™åŸŽå¸‚:",t,Object.keys(e)),null}function l(e,t){if("#/portalmap"!==location.hash)return void s();const n=t[(0,o.getMarkerId)(e)];if(!n)return;const l=function(e){const t=Array.from(document.querySelectorAll('[class^="PortalMap_marker"], [class^="PortalMap_markerCapital"]')),n=t.length+":"+Object.keys(e).length;if(i&&r===n)return i;const a={};return t.forEach(t=>{const n=(0,o.getMarkerId)(t),i=e[n];i&&i.cityName&&(a[i.cityName]=t)}),i=a,r=n,a}(t),c=e.getBoundingClientRect(),d=c.left+c.width/2,u=c.top+c.height/2;let p=document.getElementById("map-connection-svg");for(p||(p=document.createElementNS("http://www.w3.org/2000/svg","svg"),p.id="map-connection-svg",p.style.position="fixed",p.style.left="0",p.style.top="0",p.style.width="100vw",p.style.height="100vh",p.style.pointerEvents="none",p.style.zIndex=99998,document.body.appendChild(p));p.firstChild;)p.removeChild(p.firstChild);n.airport&&n.airport.split(/,|ï¼Œ/).map(e=>e.trim()).filter(Boolean).forEach(e=>{const t=a(l,e);if(!t)return;const n=t.getBoundingClientRect(),o=n.left+n.width/2,i=n.top+n.height/2,r="#fe9898",s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",d),s.setAttribute("y1",u),s.setAttribute("x2",o),s.setAttribute("y2",i),s.setAttribute("stroke",r),s.setAttribute("stroke-width",3),s.setAttribute("opacity",.85),s.setAttribute("stroke-dasharray","8,6"),p.appendChild(s);let c=o-d,f=i-u,w=0,g=0;c>=0&&f<=0?(w=10,g=-10):c>=0&&f>0?(w=10,g=18):c<0&&f<=0?(w=-60,g=-10):(w=-60,g=18);const m=document.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("x",o+w),m.setAttribute("y",i+g),m.setAttribute("fill",r),m.setAttribute("font-size","1em"),m.setAttribute("font-weight","bold"),m.setAttribute("stroke","#222"),m.setAttribute("stroke-width","0.5"),m.setAttribute("paint-order","stroke"),m.textContent=e,p.appendChild(m)}),n.port&&n.port.split(/,|ï¼Œ/).map(e=>e.trim()).filter(Boolean).forEach(e=>{const t=a(l,e);if(!t)return;const n=t.getBoundingClientRect(),o=n.left+n.width/2,i=n.top+n.height/2,r="#98fefe",s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",d),s.setAttribute("y1",u),s.setAttribute("x2",o),s.setAttribute("y2",i),s.setAttribute("stroke",r),s.setAttribute("stroke-width",3),s.setAttribute("opacity",.85),s.setAttribute("stroke-dasharray","8,6"),p.appendChild(s);let c=o-d,f=i-u,w=0,g=0;c>=0&&f<=0?(w=10,g=-10):c>=0&&f>0?(w=10,g=18):c<0&&f<=0?(w=-60,g=-10):(w=-60,g=18);const m=document.createElementNS("http://www.w3.org/2000/svg","text");m.setAttribute("x",o+w),m.setAttribute("y",i+g),m.setAttribute("fill",r),m.setAttribute("font-size","1em"),m.setAttribute("font-weight","bold"),m.setAttribute("stroke","#222"),m.setAttribute("stroke-width","0.5"),m.setAttribute("paint-order","stroke"),m.textContent=e,p.appendChild(m)})}function s(){const e=document.getElementById("map-connection-svg");e&&(e.innerHTML="")}function c(){i=null,r=""}},564:(e,t,n)=>{"use strict";n.d(t,{O:()=>a,loadMarkerDataFromYaml:()=>l});var o=n(382),i=n(761);const r="RFcity.yaml";async function a(e){const t=o.default.dump(e);await i.pP(r,t)}async function l(){if(window.pywebview)try{const e=await i.yv(r);return o.default.load(e)||{}}catch(e){return console.warn("[markerData] æ¡Œé¢ç‰ˆè®€å– RFcity.yaml å¤±æ•—:",e),{}}else try{const e=await fetch("mod/data/RFcity.yaml");if(!e.ok)return console.warn("[markerData] fetch RFcity.yaml å¤±æ•—ï¼ŒHTTP ç‹€æ…‹:",e.status),{};const t=await e.text(),n=o.default.load(t)||{};return 0===Object.keys(n).length&&console.warn("[markerData] RFcity.yaml å…§å®¹ç‚ºç©ºæˆ–æ ¼å¼éŒ¯èª¤"),n}catch(e){return console.warn("[markerData] ç¶²é ç‰ˆè®€å– RFcity.yaml å¤±æ•—:",e),{}}}},761:(e,t,n)=>{"use strict";function o(){return window.__TAURI__&&window.__TAURI__.core}async function i(){if(o())return await window.__TAURI__.core.invoke("get_accounts");if(window.pywebview&&window.pywebview.api&&window.pywebview.api.get_accounts){const e=await window.pywebview.api.get_accounts();return"string"==typeof e?JSON.parse(e):e}return[]}async function r(){if(o())return await window.__TAURI__.core.invoke("get_active_account");if(window.pywebview&&window.pywebview.api&&window.pywebview.api.get_active_account){const e=await window.pywebview.api.get_active_account();return"string"==typeof e?JSON.parse(e):e}return null}async function a(e){return o()?await window.__TAURI__.core.invoke("add_account",{data:JSON.stringify(e)}):!!(window.pywebview&&window.pywebview.api&&window.pywebview.api.add_account)&&await window.pywebview.api.add_account(JSON.stringify(e))}async function l(e){return o()?await window.__TAURI__.core.invoke("delete_account",{idx:e}):!!(window.pywebview&&window.pywebview.api&&window.pywebview.api.delete_account)&&await window.pywebview.api.delete_account(e)}async function s(e,t){return o()?await window.__TAURI__.core.invoke("save_yaml",{filename:e,content:t}):!!(window.pywebview&&window.pywebview.api&&window.pywebview.api.save_yaml)&&await window.pywebview.api.save_yaml(e,t)}async function c(e){return o()?await window.__TAURI__.core.invoke("load_yaml",{filename:e}):window.pywebview&&window.pywebview.api&&window.pywebview.api.load_yaml?await window.pywebview.api.load_yaml(e):""}n.d(t,{F7:()=>a,P4:()=>i,lw:()=>l,pP:()=>s,yq:()=>r,yv:()=>c})}},n={};function o(e){var i=n[e];if(void 0!==i)return i.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,o),r.exports}o.m=t,o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce((t,n)=>(o.f[n](e,t),t),[])),o.u=e=>e+".main.bundle.js",o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},o.l=(t,n,i,r)=>{if(e[t])e[t].push(n);else{var a,l;if(void 0!==i)for(var s=document.getElementsByTagName("script"),c=0;c<s.length;c++){var d=s[c];if(d.getAttribute("src")==t){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.src=t),e[t]=[n];var u=(n,o)=>{a.onerror=a.onload=null,clearTimeout(p);var i=e[t];if(delete e[t],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach(e=>e(o)),n)return n(o)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),l&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="./mod/js/",(()=>{var e={792:0};o.f.j=(t,n)=>{var i=o.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise((n,o)=>i=e[t]=[n,o]);n.push(i[2]=r);var a=o.p+o.u(t),l=new Error;o.l(a,n=>{if(o.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",l.name="ChunkLoadError",l.type=r,l.request=a,i[1](l)}},"chunk-"+t,t)}};var t=(t,n)=>{var i,r,[a,l,s]=n,c=0;if(a.some(t=>0!==e[t])){for(i in l)o.o(l,i)&&(o.m[i]=l[i]);s&&s(o)}for(t&&t(n);c<a.length;c++)r=a[c],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";var e=o(761);function t(e,t=document){return t.querySelector(e)}if("number"!=typeof window.currentSelectedAccountIdx){const e=sessionStorage.getItem("currentSelectedAccountIdx");window.currentSelectedAccountIdx=null!==e?parseInt(e):0}async function n(o,i){let r=[];try{r=await e.P4()}catch(e){}window.currentSelectedAccountIdx>=r.length&&(window.currentSelectedAccountIdx=0,sessionStorage.setItem("currentSelectedAccountIdx",0));let a="";a+='<div style="margin-bottom:8px;font-size:1em;">å¸³è™Ÿç®¡ç†</div>',a+='<div id="account-list" style="min-height:60px;max-height:120px;overflow-y:auto;margin-bottom:8px;">',r.forEach((e,t)=>{a+=`<div style="display:flex;align-items:center;margin-bottom:2px;">\n            <input type="radio" name="account-radio" value="${t}" ${t===window.currentSelectedAccountIdx?"checked":""} style="margin-right:6px;">\n            <span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${e.account}</span>\n            <button type="button" class="del-account-btn" data-idx="${t}" style="margin-left:6px;background:#333;color:#fff;border:none;border-radius:3px;padding:2px 7px;cursor:pointer;">åˆªé™¤</button>\n        </div>`}),a+="</div>",a+='<button id="show-add-account" style="background:#444;color:#fff;border:none;padding:6px 0;border-radius:6px;cursor:pointer;width:100%;margin-bottom:4px;">æ–°å¢žå¸³è™Ÿ</button>',a+='<form id="add-account-form" style="display:none;flex-direction:column;gap:4px;margin-bottom:4px;">\n        <input id="add-account-input" type="text" placeholder="å¸³è™Ÿ" style="padding:5px;border-radius:4px;border:1px solid #444;background:#222;color:#fff;">\n        <input id="add-password-input" type="password" placeholder="å¯†ç¢¼" style="padding:5px;border-radius:4px;border:1px solid #444;background:#222;color:#fff;">\n        <button type="submit" style="background:#444;color:#fff;border:none;padding:6px 0;border-radius:6px;cursor:pointer;">å„²å­˜</button>\n    </form>',o.innerHTML=a,t("#show-add-account").onclick=function(){t("#add-account-form").style.display="flex",this.style.display="none"},document.querySelectorAll('input[name="account-radio"]').forEach(e=>{e.onchange=async function(){if(window.currentSelectedAccountIdx=parseInt(this.value),sessionStorage.setItem("currentSelectedAccountIdx",window.currentSelectedAccountIdx),n(o,i),i(),window.syncAudioControlsWithConfig&&window.pywebview&&window.pywebview.api)try{const e=await window.pywebview.api.get_accounts(),t=parseInt(this.value);if(e&&t<e.length){const n=e[t];window.syncAudioControlsWithConfig(n)}else window.syncAudioControlsWithConfig()}catch(e){window.syncAudioControlsWithConfig()}window.syncFactionFilterFromConfig&&setTimeout(window.syncFactionFilterFromConfig,300);const e=document.getElementById("account-select");e&&(e.selectedIndex=window.currentSelectedAccountIdx,e.dispatchEvent(new Event("change",{bubbles:!0})))}}),document.querySelectorAll(".del-account-btn").forEach(t=>{t.onclick=async function(){await e.lw(parseInt(this.dataset.idx)),window.currentSelectedAccountIdx>=r.length-1&&(window.currentSelectedAccountIdx=0),sessionStorage.setItem("currentSelectedAccountIdx",window.currentSelectedAccountIdx),n(o,i)}}),t("#add-account-form").onsubmit=async function(a){a.preventDefault();const l=t("#add-account-input").value,s=t("#add-password-input").value;l&&s&&(await e.F7({account:l,password:s}),window.currentSelectedAccountIdx=r.length,sessionStorage.setItem("currentSelectedAccountIdx",window.currentSelectedAccountIdx),n(o,i),i())}}async function i(){let e=null;try{e=await r()}catch(e){}if(e){console.log(`è‡ªå‹•å¡«å…¥å°‡ä½¿ç”¨é¸æ“‡çš„å¸³è™Ÿ: ${e.account}`);let t=0,n=setInterval(function(){let o=Array.from(document.querySelectorAll("input")).filter(e=>!e.closest("#custom-controls")).find(e=>e.placeholder&&e.placeholder.includes("å¸³è™Ÿ")),i=Array.from(document.querySelectorAll("input")).filter(e=>!e.closest("#custom-controls")).find(e=>"password"===e.type);if(!o||!i){const e=Array.from(document.querySelectorAll("input")).filter(e=>!e.closest("#custom-controls"));e.length>=2&&(o=e[0],i=e[1])}if(o&&i){const t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;t.call(o,e.account),t.call(i,e.password),["input","change","blur"].forEach(e=>{o.dispatchEvent(new Event(e,{bubbles:!0})),i.dispatchEvent(new Event(e,{bubbles:!0}))});const r=Array.from(document.querySelectorAll('div[class*="Login_text__SoiB+"]')).find(e=>Array.from(e.querySelectorAll("*")).some(e=>e.textContent&&e.textContent.includes("å¸³è™Ÿç™»å…¥")));if(r)["mousedown","mouseup","click"].forEach(e=>{r.dispatchEvent(new MouseEvent(e,{bubbles:!0}))});else{const e=Array.from(document.querySelectorAll('button,input[type="button"],input[type="submit"]')).find(e=>e.textContent.includes("ç™»å…¥")||"ç™»å…¥"===e.value);e&&["mousedown","mouseup","click"].forEach(t=>{e.dispatchEvent(new MouseEvent(t,{bubbles:!0}))})}clearInterval(n)}++t>20&&clearInterval(n)},800)}}async function r(){try{const t=await e.P4();if(!t||0===t.length)return null;const n=document.querySelector('input[name="account-radio"]:checked');if(n){const e=parseInt(n.value);if(e>=0&&e<t.length){const n=t[e];return console.log(`è‡ªå‹•ç™»å…¥å°‡ä½¿ç”¨ç•Œé¢é¸æ“‡çš„å¸³è™Ÿ: ${n.account} (ç´¢å¼•: ${e})`),n}}const o=await e.yq();return o&&console.log(`è‡ªå‹•ç™»å…¥å›žé€€åˆ°é…ç½®ä¸­çš„æ´»å‹•å¸³è™Ÿ: ${o.account}`),o}catch(e){return console.error("ç²å–ç•¶å‰é¸æ“‡å¸³è™Ÿå¤±æ•—:",e),null}}window.autoLogin=function(e,t){if(!location.hash.startsWith("#/users/log_in"))return;let n=0,o=setInterval(function(){if(location.hash.startsWith("#/home"))clearInterval(o);else{var i=document.querySelector(".Login_loginRow1__idwSI .Login_formBtn__L1ZuE");i&&["mousedown","mouseup","click"].forEach(e=>{i.dispatchEvent(new MouseEvent(e,{bubbles:!0}))});var r=document.querySelector(".Login_loginFormBox__LKcQJ");if(r){var a=r.querySelector('input[type="text"]'),l=r.querySelector('input[type="password"]');if(a&&l){var s=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;s.call(a,e),s.call(l,t),["input","change","blur"].forEach(e=>{a.dispatchEvent(new Event(e,{bubbles:!0})),l.dispatchEvent(new Event(e,{bubbles:!0}))}),clearInterval(o);let n=0,i=setInterval(function(){if(location.hash.startsWith("#/home"))clearInterval(i);else{var e=r.querySelector(".Login_formBtn__L1ZuE.ClickEffect");e&&(["mousedown","mouseup","click"].forEach(t=>{e.dispatchEvent(new MouseEvent(t,{bubbles:!0}))}),clearInterval(i)),++n>30&&clearInterval(i)}},200)}}++n>30&&clearInterval(o)}},200)},window.addEventListener("hashchange",async function(){if(location.hash.startsWith("#/users/log_in"))try{const e=await r();e&&e.account&&e.password&&setTimeout(()=>{window.autoLogin(e.account,e.password)},300)}catch(e){}}),location.hash.startsWith("#/users/log_in")&&(async()=>{try{const e=await r();e&&e.account&&e.password&&setTimeout(()=>{window.autoLogin(e.account,e.password)},300)}catch(e){}})(),window.addEventListener("hashchange",function(){});let a=location.hash,l=setInterval(()=>{location.hash!==a&&(location.hash.startsWith("#/users/log_in")&&(async()=>{try{const e=await r();e&&e.account&&e.password&&setTimeout(()=>{window.autoLogin(e.account,e.password)},300)}catch(e){}})(),location.hash.startsWith("#/home")&&clearInterval(l),a=location.hash)},300);o(182),o(356),document.addEventListener("DOMContentLoaded",function(){window._keyboardInitDone||(window._keyboardInitDone=!0,console.log("åˆå§‹åŒ–éµç›¤ç›£è½å™¨"),window.addEventListener("keydown",function(e){if(console.log("æŒ‰éµæŒ‰ä¸‹:",e.key,e.keyCode),("Escape"===e.key||27===e.keyCode)&&window.pywebview&&window.pywebview.api&&(console.log("è§¸ç™¼ESCåˆ‡æ›åŠŸèƒ½é¸å–®"),window.pywebview.api.toggle_menu(),e.preventDefault()),"F11"===e.key||122===e.keyCode)return console.log("keyboardInit: è§¸ç™¼F11å…¨å±åˆ‡æ›"),window.rfToggleFullscreen&&"function"==typeof window.rfToggleFullscreen?(console.log("keyboardInit: ä½¿ç”¨çª—å£ç®¡ç†å™¨è™•ç†F11"),window.rfToggleFullscreen()):window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_fullscreen&&(console.log("keyboardInit: ä½¿ç”¨APIè™•ç†F11"),window.pywebview.api.toggle_fullscreen()),e.preventDefault(),e.stopPropagation(),!1},!0),window.rfToggleMenu=function(){return!!(window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_menu)&&(window.pywebview.api.toggle_menu(),!0)},window.rfToggleFullscreen=function(){return!!(window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_fullscreen)&&(window.pywebview.api.toggle_fullscreen(),!0)},setTimeout(function(){console.log("éµç›¤ç›£è½å™¨å·²é‹è¡Œ5ç§’")},5e3))}),function(){if("loading"===document.readyState)console.log("ç­‰å¾…æ–‡æª”åŠ è¼‰å®Œæˆå¾Œåˆå§‹åŒ–éµç›¤...");else{if(window._keyboardInitDone)return;window._keyboardInitDone=!0,console.log("ç«‹å³åˆå§‹åŒ–éµç›¤ç›£è½å™¨"),window.addEventListener("keydown",function(e){if(console.log("æŒ‰éµæŒ‰ä¸‹:",e.key,e.keyCode),("Escape"===e.key||27===e.keyCode)&&window.pywebview&&window.pywebview.api&&(console.log("è§¸ç™¼ESCåˆ‡æ›åŠŸèƒ½é¸å–®"),window.pywebview.api.toggle_menu(),e.preventDefault()),"F11"===e.key||122===e.keyCode)return console.log("keyboardInit: è§¸ç™¼F11å…¨å±åˆ‡æ›"),window.rfToggleFullscreen&&"function"==typeof window.rfToggleFullscreen?(console.log("keyboardInit: ä½¿ç”¨çª—å£ç®¡ç†å™¨è™•ç†F11"),window.rfToggleFullscreen()):window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_fullscreen&&(console.log("keyboardInit: ä½¿ç”¨APIè™•ç†F11"),window.pywebview.api.toggle_fullscreen()),e.preventDefault(),e.stopPropagation(),!1},!0),window.rfToggleMenu=function(){return!!(window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_menu)&&(window.pywebview.api.toggle_menu(),!0)},window.rfToggleFullscreen=function(){return!!(window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_fullscreen)&&(window.pywebview.api.toggle_fullscreen(),!0)}}}(),window.windowState={isFullScreen:!1,previousState:null,lastToggleTime:0,debug:!1,fixedWidth:1280,fixedHeight:720,panelPosition:{x:20,y:20},savedPanelState:null};const s=window.windowState;let c=!1;function d(){const e=Date.now();if(e-s.lastToggleTime<500)console.log("é˜²æ­¢é‡è¤‡è§¸ç™¼å…¨å±åˆ‡æ›");else{s.lastToggleTime=e,console.log("è¦–çª—ç®¡ç†å™¨: åˆ‡æ›å…¨å±é¡¯ç¤º");try{const e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(s.isFullScreen=!!e,p(),s.isFullScreen)try{window.pywebview&&window.pywebview.api&&"function"==typeof window.pywebview.api.set_window_size&&(console.log("è¦–çª—ç®¡ç†å™¨: å°‡åœ¨é€€å‡ºå…¨å±å¾Œè¨­ç½®å›ºå®šçª—å£å¤§å°",s.fixedWidth,s.fixedHeight),s.exitingFullscreen=!0)}catch(e){console.error("è¦–çª—ç®¡ç†å™¨: è™•ç†å…¨å±é€€å‡ºå¤±æ•—",e)}else s.savedWidth=window.innerWidth||s.fixedWidth,s.savedHeight=window.innerHeight||s.fixedHeight,console.log(`è¦–çª—ç®¡ç†å™¨: ä¿å­˜ç•¶å‰çª—å£å¤§å° ${s.savedWidth}x${s.savedHeight}`);window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_fullscreen?(console.log("è¦–çª—ç®¡ç†å™¨: èª¿ç”¨ pywebview API åˆ‡æ›å…¨å±"),window.pywebview.api.toggle_fullscreen()):(console.warn("è¦–çª—ç®¡ç†å™¨: æ‰¾ä¸åˆ° pywebview API"),u()),setTimeout(()=>{f();const e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s.exitingFullscreen&&!e&&window.pywebview&&window.pywebview.api&&"function"==typeof window.pywebview.api.set_window_size&&(console.log("è¦–çª—ç®¡ç†å™¨: å¾žå…¨å±é€€å‡ºï¼Œè¨­ç½®å›ºå®šçª—å£å¤§å°"),window.pywebview.api.set_window_size(s.fixedWidth,s.fixedHeight),s.exitingFullscreen=!1),s.isFullScreen=!!e},300)}catch(e){console.error("è¦–çª—ç®¡ç†å™¨: åˆ‡æ›å…¨å±å¤±æ•—",e);try{u(),setTimeout(f,300)}catch(e){console.error("è¦–çª—ç®¡ç†å™¨: å‚™ç”¨å…¨å±åˆ‡æ›ä¹Ÿå¤±æ•—",e)}}}}function u(){try{if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen();else{const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}}catch(e){console.error("å‚™ç”¨å…¨å±åˆ‡æ›å¤±æ•—",e)}}function p(){try{const e=document.getElementById("custom-controls"),t=document.getElementById("custom-controls-toggle");if(!e||!t)return;const n="none"!==e.style.display&&""!==e.style.display;let o=s.panelPosition||{x:20,y:20};try{const i=n?e.getBoundingClientRect():t.getBoundingClientRect();i&&i.left>=0&&i.top>=0&&(o={x:i.left,y:i.top},s.panelPosition=o,console.log("è¦–çª—ç®¡ç†å™¨: æ›´æ–°é¢æ¿ä½ç½®",o))}catch(e){console.error("ç²å–é¢æ¿ä½ç½®å¤±æ•—",e)}const i={isOpen:n,position:o,timestamp:Date.now()};s.savedPanelState=i,localStorage.setItem("rf_panel_state",JSON.stringify(i)),console.log("è¦–çª—ç®¡ç†å™¨: é¢æ¿ç‹€æ…‹å·²ä¿å­˜",i)}catch(e){console.error("ä¿å­˜é¢æ¿ç‹€æ…‹å¤±æ•—",e)}}function f(){try{const e=document.getElementById("custom-controls"),t=document.getElementById("custom-controls-toggle");if(!e||!t)return;let n=s.savedPanelState;if(!n){const e=localStorage.getItem("rf_panel_state");if(e)try{n=JSON.parse(e)}catch(e){console.error("è§£æžé¢æ¿ç‹€æ…‹å¤±æ•—",e)}}if(n){if(Date.now()-n.timestamp>1e4&&(console.log("è¦–çª—ç®¡ç†å™¨: é¢æ¿ç‹€æ…‹å·²éŽæœŸï¼Œä½¿ç”¨é»˜èªä½ç½®"),n.position=s.panelPosition||{x:20,y:20}),n.position&&void 0!==n.position.x&&void 0!==n.position.y){let o=n.position.x,i=n.position.y;const r=window.innerWidth-100,a=window.innerHeight-100;o<0&&(o=0),i<0&&(i=0),o>r&&(o=r),i>a&&(i=a),e.style.left=o+"px",e.style.top=i+"px",t.style.left=o+"px",t.style.top=i+"px",s.panelPosition={x:o,y:i},console.log("è¦–çª—ç®¡ç†å™¨: é¢æ¿ä½ç½®å·²æ›´æ–°",s.panelPosition)}n.isOpen?(e.style.display="block",t.style.display="none"):(e.style.display="none",t.style.display="flex"),console.log("è¦–çª—ç®¡ç†å™¨: é¢æ¿ç‹€æ…‹å·²æ¢å¾©",n)}else{const n={x:20,y:20};e.style.left=n.x+"px",e.style.top=n.y+"px",t.style.left=n.x+"px",t.style.top=n.y+"px",s.panelPosition=n,console.log("è¦–çª—ç®¡ç†å™¨: ä½¿ç”¨é»˜èªé¢æ¿ä½ç½®",n)}}catch(e){console.error("æ¢å¾©é¢æ¿ç‹€æ…‹å¤±æ•—",e)}}function w(){console.log("è¦–çª—ç®¡ç†å™¨: åˆå§‹åŒ–"),c?console.log("è¦–çª—ç®¡ç†å™¨: F11 ç›£è½å™¨å·²å­˜åœ¨ï¼Œä¸é‡è¤‡åˆå§‹åŒ–"):(window.addEventListener("keydown",function(e){if("F11"===e.key||122===e.keyCode)return console.log("è¦–çª—ç®¡ç†å™¨: æª¢æ¸¬åˆ° F11 æŒ‰éµ"),d(),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1},!0),c=!0,console.log("è¦–çª—ç®¡ç†å™¨: F11 ç›£è½å™¨å·²è¨­ç½®")),document.addEventListener("fullscreenchange",g),document.addEventListener("webkitfullscreenchange",g),document.addEventListener("mozfullscreenchange",g),document.addEventListener("MSFullscreenChange",g),window.rfToggleFullscreen=d,window.savePanelState=p,window.restorePanelState=f,window._windowManagerInitialized=!0,console.log("è¦–çª—ç®¡ç†å™¨: åˆå§‹åŒ–å®Œæˆ")}function g(){const e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s.isFullScreen=!!e,console.log("è¦–çª—ç®¡ç†å™¨: å…¨å±ç‹€æ…‹è®Šæ›´ç‚º "+(s.isFullScreen?"å…¨å±":"çª—å£æ¨¡å¼")),setTimeout(f,200)}async function m(){let e=[{message:"ç¢ºèªè¦é›¢é–‹ é€†çµ±æˆ°ï¼šçƒ½ç« å—Žï¼Ÿ",confirm:"ç¢ºå®š",cancel:"å–æ¶ˆ"}];if(window.pywebview&&window.pywebview.api&&window.pywebview.api.load_yaml)try{const t=await window.pywebview.api.load_yaml("exit_prompts.yaml");if(t){let n=null;if(window.YAML&&window.YAML.load)n=window.YAML.load(t);else try{n=(await Promise.resolve().then(o.bind(o,382))).load(t)}catch{}Array.isArray(n)&&n.length>0&&(e=n)}}catch{}!function(e){if(document.getElementById("custom-exit-confirm"))return;const t=document.createElement("div");t.id="custom-exit-confirm",t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.width="100vw",t.style.height="100vh",t.style.background="rgba(0,0,0,0.32)",t.style.zIndex="20000",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.innerHTML=`\n      <div style="background:rgba(34,34,34,0.98);backdrop-filter:blur(6px);border-radius:14px;box-shadow:0 4px 32px #000a;padding:32px 36px 24px 36px;min-width:260px;max-width:90vw;display:flex;flex-direction:column;align-items:center;">\n        <div style="font-size:1.18em;font-weight:bold;margin-bottom:18px;letter-spacing:1px;color:#fff;text-align:center;">${e.message}</div>\n        <div style="display:flex;gap:18px;">\n          <button id="exit-confirm-yes" style="min-width:90px;min-height:38px;font-size:1em;background:#d9534f;color:#fff;border:none;border-radius:8px;box-shadow:0 2px 8px #0003;cursor:pointer;transition:background 0.18s;">${e.confirm}</button>\n          <button id="exit-confirm-no" style="min-width:90px;min-height:38px;font-size:1em;background:#444;color:#fff;border:none;border-radius:8px;box-shadow:0 2px 8px #0002;cursor:pointer;transition:background 0.18s;">${e.cancel}</button>\n        </div>\n      </div>\n      <style>\n        #exit-confirm-yes:hover { background: #b52b27 !important; }\n        #exit-confirm-no:hover { background: #222 !important; }\n      </style>\n    `,document.body.appendChild(t),document.getElementById("exit-confirm-yes").onclick=function(){const e=t.querySelector("div > div:first-child");e&&(e.textContent="æ­£åœ¨é—œé–‰æ‡‰ç”¨..."),t.querySelectorAll("button").forEach(e=>{e.disabled=!0,e.style.opacity="0.5",e.style.cursor="not-allowed"}),window.pywebview&&window.pywebview.api&&window.pywebview.api.exit_app?(window.pywebview.api.exit_app(),setTimeout(()=>{try{window.close()}catch(e){}setTimeout(()=>{e&&(e.textContent="è«‹æ‰‹å‹•é—œé–‰æ‡‰ç”¨è¦–çª—")},2e3)},3e3)):window.close()},document.getElementById("exit-confirm-no").onclick=function(){document.body.removeChild(t)}}(e[Math.floor(Math.random()*e.length)])}document.addEventListener("DOMContentLoaded",w),"loading"!==document.readyState&&w();const y=[{name:"è’™å¤",color:"rgb(0, 138, 247)"},{name:"è‡ºç£",color:"rgb(6, 133, 158)"},{name:"æ»¿æ´²",color:"rgb(252, 185, 0)"},{name:"é¦™æ¸¯",color:"rgb(174, 67, 236)"},{name:"åè³Šè¯ç›Ÿ",color:"rgb(255, 255, 255)"},{name:"è—åœ‹",color:"rgb(70, 190, 127)"},{name:"ç¶­å¾çˆ¾",color:"rgb(116, 160, 246)"},{name:"å“ˆè–©å…‹",color:"rgb(0, 233, 228)"},{name:"ç´…è»",color:"rgb(253, 30, 25)"},{name:"æ–°ä¸­åœ‹ç‹‚æ­¡",color:"rgb(109, 109, 109)"}];function h(e){if(!e)return"æœªçŸ¥";e=(e=function(e){if(!e)return"";if("#"===(e=e.trim().replace(/\s+/g,""))[0]){let t,n,o;return 7===e.length?(t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16)):4===e.length&&(t=parseInt(e[1]+e[1],16),n=parseInt(e[2]+e[2],16),o=parseInt(e[3]+e[3],16)),`rgb(${t},${n},${o})`}if(e.startsWith("rgba")){const t=e.match(/rgba\((\d+),(\d+),(\d+),/);if(t)return`rgb(${t[1]},${t[2]},${t[3]})`}return e.startsWith("rgb")?e.replace(/\s+/g,""):e}(e)).replace(/\s+/g,"");let t=y.find(t=>t.color.replace(/\s+/g,"")===e);if(!t){const n=e.match(/rgb\((\d+),(\d+),(\d+)\)/);if(n){const e=parseInt(n[1]),o=parseInt(n[2]),i=parseInt(n[3]);t=y.find(t=>{const n=t.color.replace(/\s+/g,"").match(/rgb\((\d+),(\d+),(\d+)\)/);return!!n&&parseInt(n[1])===e&&parseInt(n[2])===o&&parseInt(n[3])===i})}}return t?t.name:"æœªçŸ¥"}function b(){return y.map(e=>({...e}))}function v(e){if(!e)return"";let t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(t)return`rgb(${parseInt(t[1])},${parseInt(t[2])},${parseInt(t[3])})`;if("#"===e[0]){let t=e.replace("#","");if(3===t.length&&(t=t.split("").map(e=>e+e).join("")),6===t.length)return`rgb(${parseInt(t.substr(0,2),16)},${parseInt(t.substr(2,2),16)},${parseInt(t.substr(4,2),16)})`}return e.trim()}function x(e,t){const n=Array.from(document.querySelectorAll('[class^="PortalMap_marker"], [class^="PortalMap_markerCapital"]')),o={};n.forEach(e=>{let t=e.style.backgroundColor;t||(t=window.getComputedStyle(e).backgroundColor),t=v(t),t&&(o[t]||(o[t]=0),o[t]++)});const i=[],r=new Set;return n.forEach(n=>{const a=n.style.left||"",l=n.style.top||"",s=parseFloat(a.replace("calc(","").replace("%)",""))/100,c=parseFloat(l.replace("calc(","").replace("%)",""))/100,d=Math.round(s*e),u=Math.round(c*t),p=`${d},${u}`;let f=n.style.backgroundColor;if(!f){const e=window.getComputedStyle(n);f=e.backgroundColor}f=v(f);let w=Object.keys(o).find(e=>e===f)||f;const g=h(w),m=`${p},${g},${w}`;r.has(m)||(i.push({x:d,y:u,color:w,faction:g,marker:n}),r.add(m))}),i}async function _(e,t){e.clearRect(0,0,e.canvas.width,e.canvas.height);const n=e.canvas.width,i=e.canvas.height,r=t.filter(e=>isFinite(e.x)&&isFinite(e.y)&&e.faction&&"æœªçŸ¥"!==e.faction);if(r.length<3)return;let a;if(window.d3&&window.d3.Delaunay)a=window.d3.Delaunay;else try{a=(await o.e(706).then(o.bind(o,706))).Delaunay||window.d3&&window.d3.Delaunay}catch{return}const l=r.map(e=>[e.x,e.y]),s=a.from(l).voronoi([0,0,n,i]),c=new Map;for(let e=0;e<r.length;e++){const t=r[e].color;c.has(t)||c.set(t,[]),c.get(t).push(e)}e.save(),e.globalAlpha=.22;for(const[t,o]of c.entries()){e.beginPath();for(const t of o){const n=s.cellPolygon(t);if(n&&n.length>2){let t=0;for(let e=0;e<n.length;e++){const[o,i]=n[e],[r,a]=n[(e+1)%n.length];t+=o*a-r*i}if(t=Math.abs(t)/2,t<10)continue;e.moveTo(n[0][0],n[0][1]);for(let t=1;t<n.length;t++)e.lineTo(n[t][0],n[t][1]);e.closePath()}}try{e.clip("evenodd")}catch(t){e.clip()}e.fillStyle=t,e.fillRect(0,0,n,i),e.restore(),e.save(),e.globalAlpha=.22}e.restore();const d=new Map,u=e=>[Math.round(100*e[0])/100,Math.round(100*e[1])/100],p=(e,t)=>{const n=u(e),o=u(t);return n[0]<o[0]||n[0]===o[0]&&n[1]<o[1]?`${n.join(",")}:${o.join(",")}`:`${o.join(",")}:${n.join(",")}`};for(let e=0;e<r.length;e++){const t=s.cellPolygon(e);if(!t||t.length<2)continue;let n=0;for(let e=0;e<t.length;e++){const[o,i]=t[e],[r,a]=t[(e+1)%t.length];n+=o*a-r*i}if(n=Math.abs(n)/2,!(n<10))for(let n=0;n<t.length;n++){const o=t[n],i=t[(n+1)%t.length],r=i[0]-o[0],a=i[1]-o[1];if(Math.sqrt(r*r+a*a)<2)continue;const l=p(o,i);d.has(l)||d.set(l,{sites:[],points:[o,i]}),d.get(l).sites.push(e)}}for(const{sites:t,points:n}of d.values()){const[o,i]=n;let a=!1;(t.length<2||r[t[0]].color!==r[t[1]].color)&&(a=!0),a&&(e.beginPath(),e.moveTo(o[0],o[1]),e.lineTo(i[0],i[1]),e.strokeStyle="#181818",e.lineWidth=4,e.lineCap="round",e.stroke(),e.beginPath(),e.moveTo(o[0],o[1]),e.lineTo(i[0],i[1]),e.strokeStyle="rgba(220, 220, 220, 0.8)",e.lineWidth=1.5,e.lineCap="round",e.stroke())}const f=.06*Math.max(n,i);e.save(),e.globalCompositeOperation="destination-out";let w=e.createLinearGradient(0,0,0,f);function g(e,t){if(!e)return`rgba(0,0,0,${t})`;if(e.startsWith("rgba"))return e.replace(/rgba?\(([^)]+)\)/,(e,n)=>{const o=n.split(",").map(e=>e.trim());return`rgba(${o[0]},${o[1]},${o[2]},${t})`});if(e.startsWith("rgb"))return e.replace(/rgb\(([^)]+)\)/,(e,n)=>{const o=n.split(",").map(e=>e.trim());return`rgba(${o[0]},${o[1]},${o[2]},${t})`});if("#"===e[0]){let n=e.replace("#","");if(3===n.length&&(n=n.split("").map(e=>e+e).join("")),6===n.length)return`rgba(${parseInt(n.substr(0,2),16)},${parseInt(n.substr(2,2),16)},${parseInt(n.substr(4,2),16)},${t})`}return e}w.addColorStop(0,"rgba(0,0,0,0.92)"),w.addColorStop(.05,"rgba(0,0,0,0)"),e.fillStyle=w,e.fillRect(0,0,n,f),w=e.createLinearGradient(0,i,0,i-f),w.addColorStop(0,"rgba(0,0,0,0.92)"),w.addColorStop(.05,"rgba(0,0,0,0)"),e.fillStyle=w,e.fillRect(0,i-f,n,f),w=e.createLinearGradient(0,0,f,0),w.addColorStop(0,"rgba(0,0,0,0.92)"),w.addColorStop(.05,"rgba(0,0,0,0)"),e.fillStyle=w,e.fillRect(0,0,f,i),w=e.createLinearGradient(n,0,n-f,0),w.addColorStop(0,"rgba(0,0,0,0.92)"),w.addColorStop(.05,"rgba(0,0,0,0)"),e.fillStyle=w,e.fillRect(n-f,0,f,i),e.restore();for(const{sites:t,points:n}of d.values()){const[o,i]=n;let a=!1,l=null,s=null;if(t.length<2)continue;if(l=r[t[0]].color,s=r[t[1]].color,l!==s&&(a=!0),!a)continue;const c=i[0]-o[0],d=i[1]-o[1],u=Math.sqrt(c*c+d*d);if(u<2)continue;const p=-d/u,f=c/u,w=28,m=[o[0]+p*w,o[1]+f*w],y=[i[0]+p*w,i[1]+f*w],h=[o[0]-p*w,o[1]-f*w],b=[i[0]-p*w,i[1]-f*w],v=e.createLinearGradient(m[0],m[1],h[0],h[1]);v.addColorStop(0,g(l,0)),v.addColorStop(.18,g(l,.25)),v.addColorStop(.38,g(l,.7)),v.addColorStop(.5,g(l,1)),v.addColorStop(.5,g(s,1)),v.addColorStop(.62,g(s,.7)),v.addColorStop(.82,g(s,.25)),v.addColorStop(1,g(s,0)),e.save(),e.globalAlpha=.18,e.beginPath(),e.moveTo(m[0],m[1]),e.lineTo(y[0],y[1]),e.lineTo(b[0],b[1]),e.lineTo(h[0],h[1]),e.closePath(),e.fillStyle=v,e.fill(),e.restore()}e.canvas.style.pointerEvents="none"}function k(e,t){const n=document.getElementById(e);return n||console.warn(t||`æ‰¾ä¸åˆ° DOM å…ƒç´ ï¼š${e}`),n}async function E(){const e=function(){const e=document.getElementById("account-select");if(e&&e.selectedIndex>=0)return{accountIdx:e.selectedIndex,account:e.options[e.selectedIndex].text};const t=document.querySelector('input[name="account-radio"]:checked');if(t){const e=parseInt(t.value),n=t.parentElement.querySelector("span");return{accountIdx:e,account:n?n.textContent.trim():""}}return null}();if(!e)return null;try{const t=await window.pywebview.api.get_accounts();if(t&&t.length>0)return t.find(t=>t.account===e.account)||t[0]}catch(e){console.error("ç²å–å¸³è™Ÿåˆ—è¡¨å¤±æ•—:",e)}return null}function C(){console.log("setupCustomControls called");const e=k("custom-controls","custom-controls ä¸å­˜åœ¨ï¼Œç„¡æ³•æŽ›è¼‰æŽ§åˆ¶é¢æ¿äº‹ä»¶"),t=k("custom-controls-toggle","custom-controls-toggle ä¸å­˜åœ¨ï¼Œç„¡æ³•æŽ›è¼‰æŽ§åˆ¶é¢æ¿äº‹ä»¶");if(!e||!t)return void console.error("setupCustomControls aborted: panel or toggle missing");if(function(e,t){let n={isOpen:!1,position:{x:0,y:0}},o={x:20,y:20};window.windowState&&window.windowState.panelPosition&&(o=window.windowState.panelPosition);try{const i=localStorage.getItem("rf_panel_state");if(i){const r=JSON.parse(i);if(r.isOpen?(e.style.display="block",t.style.display="none",n.isOpen=!0):(e.style.display="none",t.style.display="flex",n.isOpen=!1),r.position&&void 0!==r.position.x&&void 0!==r.position.y){let o=r.position.x,i=r.position.y;const a=window.innerWidth-100,l=window.innerHeight-100;o<0&&(o=0),i<0&&(i=0),o>a&&(o=a),i>l&&(i=l),e.style.left=o+"px",e.style.top=i+"px",t.style.left=o+"px",t.style.top=i+"px",n.position={x:o,y:i},window.windowState&&(window.windowState.panelPosition={x:o,y:i})}else e.style.left=o.x+"px",e.style.top=o.y+"px",t.style.left=o.x+"px",t.style.top=o.y+"px",n.position=o}else e.style.left=o.x+"px",e.style.top=o.y+"px",t.style.left=o.x+"px",t.style.top=o.y+"px",n.position=o}catch(i){console.error("è¼‰å…¥é¢æ¿ç‹€æ…‹å¤±æ•—:",i),e.style.left=o.x+"px",e.style.top=o.y+"px",t.style.left=o.x+"px",t.style.top=o.y+"px",n.position=o}t.onclick=function(){"none"===e.style.display&&(e.style.display="block",t.style.display="none",n.isOpen=!0,localStorage.setItem("rf_panel_state",JSON.stringify(n)))},window.toggleControlPanel=function(){"none"!==e.style.display&&e.style.display?(e.style.display="none",t.style.display="flex",n.isOpen=!1):(e.style.display="block",t.style.display="none",n.isOpen=!0),localStorage.setItem("rf_panel_state",JSON.stringify(n))},document.addEventListener("mousedown",function(o){"none"===e.style.display||e.contains(o.target)||t.contains(o.target)||o.target.closest(".dialog")||o.target.closest("#ranking-modal")||o.target.closest("#faction-map-canvas-container")||(e.style.display="none",t.style.display="flex",n.isOpen=!1,localStorage.setItem("rf_panel_state",JSON.stringify(n)))}),function(){const t=e;let n=!1,o=0,i=0,r=0,a=0;t.addEventListener("mousedown",function(e){if("INPUT"===e.target.tagName||"BUTTON"===e.target.tagName||"FORM"===e.target.tagName||e.target.isContentEditable)return;n=!0,o=e.clientX,i=e.clientY;const l=t.getBoundingClientRect();r=l.left,a=l.top,document.body.style.userSelect="none"}),window.addEventListener("mousemove",function(e){if(!n)return;let l=e.clientX-o,s=e.clientY-i;t.style.left=r+l+"px",t.style.top=a+s+"px",t.style.right="auto"}),window.addEventListener("mouseup",function(){if(n){const e=t.getBoundingClientRect(),n=0,o=0,i=window.innerWidth-Math.min(e.width,300),r=window.innerHeight-Math.min(e.height,100);let a=e.left,l=e.top;e.left<n&&(a=n),e.top<o&&(l=o),e.left>i&&(a=i),e.top>r&&(l=r),t.style.left=a+"px",t.style.top=l+"px",window.windowState&&(window.windowState.panelPosition={x:a,y:l});try{const e=localStorage.getItem("rf_panel_state")||"{}",t=JSON.parse(e);t.position={x:a,y:l},t.timestamp=Date.now(),localStorage.setItem("rf_panel_state",JSON.stringify(t))}catch(e){console.error("ä¿å­˜é¢æ¿ä½ç½®å¤±æ•—:",e)}}n=!1,document.body.style.userSelect=""}),t.style.position="fixed",t.style.top=t.style.top||"20px",t.style.right=t.style.right||"20px"}(),function(){const n=t,o=e;let i=!1,r=0,a=0,l=0,s=0;n.addEventListener("mousedown",function(e){i=!0,r=e.clientX,a=e.clientY;const t=n.getBoundingClientRect();l=t.left,s=t.top,document.body.style.userSelect="none"}),window.addEventListener("mousemove",function(e){if(!i)return;let t=e.clientX-r,c=e.clientY-a;n.style.left=l+t+"px",n.style.top=s+c+"px",n.style.right="auto",o.style.left=n.style.left,o.style.top=n.style.top,o.style.right="auto"}),window.addEventListener("mouseup",function(){if(i){const e=n.getBoundingClientRect(),t=0,i=0,r=window.innerWidth-e.width,a=window.innerHeight-e.height;let l=e.left,s=e.top;e.left<t&&(l=t),e.top<i&&(s=i),e.left>r&&(l=r),e.top>a&&(s=a),n.style.left=l+"px",n.style.top=s+"px",o.style.left=l+"px",o.style.top=s+"px";try{const e=localStorage.getItem("rf_panel_state")||"{}",t=JSON.parse(e);t.position={x:l,y:s},localStorage.setItem("rf_panel_state",JSON.stringify(t))}catch(e){console.error("ä¿å­˜é¢æ¿ä½ç½®å¤±æ•—:",e)}}i=!1,document.body.style.userSelect=""}),n.style.position="fixed",n.style.top=n.style.top||"20px",n.style.right=n.style.right||"20px"}()}(e,t),!document.getElementById("floating-esc-hint")){const i=document.createElement("div");i.id="floating-esc-hint",i.textContent="æŒ‰ ESC æ‰“é–‹æŽ§åˆ¶é¢æ¿",i.style.position="fixed",i.style.bottom="10px",i.style.right="10px",i.style.backgroundColor="rgba(0, 0, 0, 0.5)",i.style.color="white",i.style.padding="5px 10px",i.style.borderRadius="4px",i.style.fontSize="12px",i.style.zIndex="9990",i.style.opacity="0.7",i.style.transition="opacity 1s",document.body.appendChild(i),setTimeout(()=>{i.style.opacity="0",setTimeout(()=>i.remove(),1e3)},5e3)}setTimeout(()=>{const e=document.getElementById("exit-app");e&&(e.onclick=m)},100);const n=document.getElementById("toggle-faction-map"),o=document.getElementById("faction-map-canvas-container");if(n&&o&&function(e,t){let n=!1,o=null,i=null;const r=document.getElementById("faction-map-canvas"),a=r.getContext("2d");function l(){const e=document.querySelector(".PortalMap_mapArea__h7Err");if(!e)return;const n=e.getBoundingClientRect();t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.width=n.width+"px",t.style.height=n.height+"px",t.style.pointerEvents="none",r.width=n.width,r.height=n.height,r.style.width=n.width+"px",r.style.height=n.height+"px"}function s(){t.style.display="none",e.textContent="é¡¯ç¤ºå‹¢åŠ›åˆ†å¸ƒåœ–",a.clearRect(0,0,r.width,r.height),c(),window.removeEventListener("resize",l),n=!1}function c(){o&&(o.disconnect(),o=null),i&&(clearTimeout(i),i=null)}window.addEventListener("hashchange",function(){"#/portalmap"!==location.hash&&s()}),window.addEventListener("popstate",function(){"#/portalmap"!==location.hash&&s()}),"#/portalmap"!==location.hash&&s(),e.onclick=function(){if("#/portalmap"===location.hash)if(n=!n,n){!function(){const e=document.querySelector(".PortalMap_mapArea__h7Err");if(!e)return;const n=e.querySelector("img.PortalMap_fakeMapImg__y7a1r, img.PortalMap_mapImg__JJkQ7");n&&t.parentNode!==e&&(n.nextSibling?e.insertBefore(t,n.nextSibling):e.appendChild(t)),t.style.zIndex="2",r.style.zIndex="2"}(),l(),t.style.display="block",e.textContent="éš±è—å‹¢åŠ›åˆ†å¸ƒåœ–";const s=x(r.width,r.height);_(a,s),function(){if(o)return;const e=document.querySelector(".PortalMap_mapBox__3WtlM")||document.body;o=new MutationObserver(e=>{let t=!1;for(const n of e){if("attributes"===n.type&&("class"===n.attributeName||"style"===n.attributeName)){t=!0;break}if("childList"===n.type){t=!0;break}}t&&n&&(i&&clearTimeout(i),i=setTimeout(()=>{const e=x(r.width,r.height);_(a,e)},200))}),o.observe(e,{subtree:!0,attributes:!0,attributeFilter:["class","style"],childList:!0})}(),window.addEventListener("resize",l)}else t.style.display="none",e.textContent="é¡¯ç¤ºå‹¢åŠ›åˆ†å¸ƒåœ–",a.clearRect(0,0,r.width,r.height),c(),window.removeEventListener("resize",l);else s()},setInterval(()=>{n&&!document.querySelector(".PortalMap_mapArea__h7Err")&&s()},500)}(n,o),function(e){async function t(){const e=function(){const e=document.querySelector('input[name="account-radio"]:checked');if(e){const t=parseInt(e.value),n=e.parentElement.querySelector("span");if(n)return{accountName:n.textContent.trim(),accountIdx:t}}return null}();if(!e)return null;try{const t=await window.pywebview.api.get_accounts();if(t&&e.accountIdx<t.length)return t[e.accountIdx]}catch(e){console.error("ç²å–å¸³è™Ÿåˆ—è¡¨å¤±æ•—:",e)}return null}if(!document.getElementById("rf-audio-controls")){const t=document.createElement("div");t.id="rf-audio-controls",t.innerHTML='\n            <div style="border-top: 1px solid #555; margin: 16px 0 12px 0;"></div>\n            <div style="margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; font-size: 0.95em;">\n                <label for="bgm-volume-slider" style="margin-right: 10px;">BGMéŸ³é‡</label>\n                <input type="range" id="bgm-volume-slider" min="0" max="1" step="0.01" value="0" style="flex-grow: 1; margin: 0 8px; accent-color:#2a7cff;">\n                <span class="volume-value" style="width: 30px; text-align: right; font-variant-numeric: tabular-nums;">0</span>\n            </div>\n            <div style="margin-bottom: 12px; display: flex; align-items: center; justify-content: space-between; font-size: 0.95em;">\n                <label for="se-volume-slider" style="margin-right: 10px;">éŸ³æ•ˆéŸ³é‡</label>\n                <input type="range" id="se-volume-slider" min="0" max="1" step="0.01" value="0" style="flex-grow: 1; margin: 0 8px; accent-color:#1dbf60;">\n                <span class="volume-value" style="width: 30px; text-align: right; font-variant-numeric: tabular-nums;">0</span>\n            </div>\n            <div style="margin-bottom: 4px;">\n                <button id="se147-toggle-button" style="width:100%; background:#d9534f; color:#fff; border:none; padding:8px 0; border-radius:6px; cursor:pointer; font-size: 0.95em; transition: background-color 0.2s;">æˆ°å ±é€šçŸ¥ï¼šé—œ</button>\n                <input type="checkbox" id="se147-toggle" style="display: none;">\n            </div>\n        ',e.appendChild(t),setTimeout(()=>{a||l()},50)}window.updateCustomControlsUI=function(e){if(!e)return void console.warn("updateCustomControlsUI: æ²’æœ‰æä¾›é…ç½®æ•¸æ“š");console.log("updateCustomControlsUI: æ›´æ–°éŸ³é‡æŽ§åˆ¶ UIï¼Œé…ç½®:",e);const t=document.getElementById("bgm-volume-slider"),n=t?t.parentElement.querySelector(".volume-value"):null;t&&"number"==typeof e.bgm?(console.log(`æ›´æ–° BGM æ»‘å¡Š: ${e.bgm}`),t.value=e.bgm,n&&(n.textContent=Math.round(100*e.bgm)),window._rf_bgm_volume=e.bgm,window._rf_bgmGainNodes&&Array.isArray(window._rf_bgmGainNodes)&&window._rf_bgmGainNodes.forEach(t=>{t&&t.gain&&(t.gain.value=e.bgm)}),window.setMediaVolume&&window.setMediaVolume()):console.warn("updateCustomControlsUI: BGM æ»‘å¡Šä¸å­˜åœ¨æˆ– BGM å€¼ç„¡æ•ˆ");const o=document.getElementById("se-volume-slider"),i=o?o.parentElement.querySelector(".volume-value"):null;o&&"number"==typeof e.se?(console.log(`æ›´æ–° SE æ»‘å¡Š: ${e.se}`),o.value=e.se,i&&(i.textContent=Math.round(100*e.se)),window._rf_se_volume=e.se,window._rf_seGainNodes&&Array.isArray(window._rf_seGainNodes)&&window._rf_seGainNodes.forEach(t=>{t&&t.gain&&(t.gain.value=e.se)}),window.setMediaVolume&&window.setMediaVolume(),window.updateSe147Volume&&window.updateSe147Volume()):console.warn("updateCustomControlsUI: SE æ»‘å¡Šä¸å­˜åœ¨æˆ– SE å€¼ç„¡æ•ˆ");const r=document.getElementById("se147-toggle"),a=document.getElementById("se147-toggle-button");if(r&&a){const t="boolean"==typeof e.se147Muted?e.se147Muted:!!window._rf_se147Muted;console.log(`æ›´æ–° SE147 åˆ‡æ›æŒ‰éˆ•: ${t}`),r.checked=t,a.textContent="æˆ°å ±é€šçŸ¥ï¼š"+(t?"é—œ":"é–‹"),a.style.backgroundColor=t?"#d9534f":"#5cb85c",window._rf_se147Muted=t,window.updateSe147Volume&&window.updateSe147Volume()}else console.warn("updateCustomControlsUI: SE147 åˆ‡æ›æŒ‰éˆ•ä¸å­˜åœ¨");console.log("updateCustomControlsUI: UI æ›´æ–°å®Œæˆ")};const n=document.getElementById("bgm-volume-slider");if(n){let e=null,o=!1;n.addEventListener("mousedown",function(){o=!0,clearTimeout(e)}),n.addEventListener("touchstart",function(){o=!0,clearTimeout(e)}),n.addEventListener("input",function(){const t=Number(this.value);this.parentElement.querySelector(".volume-value").textContent=Math.round(100*t),window.setBGMVolume&&(window._rf_bgm_volume=t,window._rf_bgmGainNodes&&Array.isArray(window._rf_bgmGainNodes)&&window._rf_bgmGainNodes.forEach(e=>{e&&e.gain&&(e.gain.value=t)}),window.setMediaVolume&&window.setMediaVolume()),clearTimeout(e)}),document.addEventListener("mouseup",function(){if(o){o=!1;const e=Number(n.value);window.pywebview&&window.pywebview.api&&window.pywebview.api.save_config_volume&&t().then(t=>{const n={bgm:e,se:null,se147Muted:null};t&&(n.target_account=t),window.pywebview.api.save_config_volume(n).catch(e=>{console.error("éŸ³é‡è¨­å®šä¿å­˜å¤±æ•—",e)})})}}),document.addEventListener("touchend",function(){if(o){o=!1;const e=Number(n.value);window.pywebview&&window.pywebview.api&&window.pywebview.api.save_config_volume&&t().then(t=>{const n={bgm:e,se:null,se147Muted:null};t&&(n.target_account=t),window.pywebview.api.save_config_volume(n).catch(e=>{console.error("éŸ³é‡è¨­å®šä¿å­˜å¤±æ•—",e)})})}})}const o=document.getElementById("se-volume-slider");if(o){let e=null,n=!1;o.addEventListener("mousedown",function(){n=!0,clearTimeout(e)}),o.addEventListener("touchstart",function(){n=!0,clearTimeout(e)}),o.addEventListener("input",function(){const t=Number(this.value);this.parentElement.querySelector(".volume-value").textContent=Math.round(100*t),window.setSEVolume&&(window._rf_se_volume=t,window._rf_seGainNodes&&Array.isArray(window._rf_seGainNodes)&&window._rf_seGainNodes.forEach(e=>{e&&e.gain&&(e.gain.value=t)}),window.setMediaVolume&&window.setMediaVolume(),window.updateSe147Volume&&window.updateSe147Volume()),clearTimeout(e)}),document.addEventListener("mouseup",function(){if(n){n=!1;const e=Number(o.value);window.pywebview&&window.pywebview.api&&window.pywebview.api.save_config_volume&&t().then(t=>{const n={bgm:null,se:e,se147Muted:null};t&&(n.target_account=t),window.pywebview.api.save_config_volume(n).catch(e=>{console.error("éŸ³é‡è¨­å®šä¿å­˜å¤±æ•—",e)})})}}),document.addEventListener("touchend",function(){if(n){n=!1;const e=Number(o.value);window.pywebview&&window.pywebview.api&&window.pywebview.api.save_config_volume&&t().then(t=>{const n={bgm:null,se:e,se147Muted:null};t&&(n.target_account=t),window.pywebview.api.save_config_volume(n).catch(e=>{console.error("éŸ³é‡è¨­å®šä¿å­˜å¤±æ•—",e)})})}})}const i=document.getElementById("se147-toggle-button"),r=document.getElementById("se147-toggle");if(i&&r&&!i.dataset.listenerAttached){i.dataset.listenerAttached="true";let e=!1,n=0;const o=e=>{r.checked=e,i.textContent="æˆ°å ±é€šçŸ¥ï¼š"+(e?"é—œ":"é–‹"),i.style.backgroundColor=e?"#d9534f":"#5cb85c"};i.addEventListener("click",async function(){const r=Date.now();if(r-n<300)console.log("é»žæ“ŠéŽå¿«ï¼Œå¿½ç•¥");else if(n=r,!e){e=!0,i.disabled=!0;try{const e=!window._rf_se147Muted;if(window._rf_se147Muted=e,o(e),window.setMediaVolume&&window.setMediaVolume(),window.updateSe147Volume&&window.updateSe147Volume(),window.pywebview&&window.pywebview.api&&window.pywebview.api.save_config_volume){const n=await t(),o={bgm:null,se:null,se147Muted:e};n&&(o.target_account=n),await window.pywebview.api.save_config_volume(o),console.log("æˆ°å ±é€šçŸ¥è¨­å®šå·²ä¿å­˜:",e)}}catch(e){console.error("æˆ°å ±é€šçŸ¥è¨­å®šå¤±æ•—",e);const t=!window._rf_se147Muted;window._rf_se147Muted=t,o(t)}finally{i.disabled=!1,e=!1}}})}let a=!1;window.syncAudioControlsWithConfig=async function(e=null){if(window.pywebview&&window.pywebview.api&&window.pywebview.api.get_config_volume)try{console.log("é–‹å§‹éŸ³é‡åŒæ­¥..."),e||(e=await t()),console.log("ä½¿ç”¨å¸³è™Ÿè³‡æ–™:",e);const n=await window.pywebview.api.get_config_volume(e);console.log("ç²å–éŸ³é‡è¨­å®š:",n),window.applyAudioConfig?window.applyAudioConfig(n):("number"==typeof n.bgm&&(window._rf_bgm_volume=n.bgm,window._rf_bgmGainNodes&&Array.isArray(window._rf_bgmGainNodes)&&window._rf_bgmGainNodes.forEach(e=>{e&&e.gain&&(e.gain.value=n.bgm)})),"number"==typeof n.se&&(window._rf_se_volume=n.se,window._rf_seGainNodes&&Array.isArray(window._rf_seGainNodes)&&window._rf_seGainNodes.forEach(e=>{e&&e.gain&&(e.gain.value=n.se)})),"boolean"==typeof n.se147Muted&&(window._rf_se147Muted=n.se147Muted),window.setMediaVolume&&window.setMediaVolume(),window.updateSe147Volume&&window.updateSe147Volume()),window.updateCustomControlsUI&&window.updateCustomControlsUI(n),console.log("éŸ³é‡åŒæ­¥å®Œæˆ")}catch(e){console.error("éŸ³é‡åŒæ­¥å¤±æ•—:",e)}else console.log("API å°šæœªæº–å‚™å¥½ï¼Œè·³éŽéŸ³é‡åŒæ­¥")};const l=()=>{if(a)return;const e=document.getElementById("bgm-volume-slider"),t=document.getElementById("se-volume-slider");e&&t?window.pywebview&&window.pywebview.api&&window.pywebview.api.get_config_volume?(a=!0,window.syncAudioControlsWithConfig()):setTimeout(l,250):setTimeout(l,100)};window.addEventListener("pywebviewready",l),document.addEventListener("DOMContentLoaded",l),setTimeout(()=>{a||l()},1e3)}(e),function(e){if(document.getElementById("rf-faction-filter"))return;const t=document.createElement("div");t.style.cssText="margin-bottom: 12px; position: relative; display: flex; align-items: center;";const n=document.createElement("label");n.textContent="æˆ°å ±é€šçŸ¥éŽæ¿¾ï¼š",n.style.cssText="margin-right: 8px; flex-shrink: 0;";const o=document.createElement("div");o.id="rf-faction-filter",o.tabIndex=0,o.style.cssText="\n        padding: 4px 8px;\n        border-radius: 6px;\n        font-size: 0.95em;\n        background: #222;\n        color: #fff;\n        border: 1px solid #555;\n        margin-left: 2px;\n        position: relative;\n        pointer-events: auto;\n        cursor: pointer;\n        outline: none;\n        min-width: 100px;\n        user-select: none;\n    ";const i=document.createElement("span");i.textContent="å…¨éƒ¨",i.style.cssText="display: block;",o.appendChild(i);const r=document.createElement("div");r.style.cssText="\n        position: absolute;\n        top: 100%;\n        left: 0;\n        right: 0;\n        background: #222;\n        border: 1px solid #555;\n        border-top: none;\n        border-radius: 0 0 6px 6px;\n        display: none;\n        z-index: 1000;\n        margin-top: -1px;\n        box-shadow: 0 4px 8px rgba(0,0,0,0.3);\n    ";const a=["å…¨éƒ¨",...b().map(e=>e.name).filter(e=>"æ–°ä¸­åœ‹ç‹‚æ­¡"!==e)];let l="å…¨éƒ¨";async function s(e=0){if(window.pywebview&&window.pywebview.api&&window.pywebview.api.get_report_faction_filter)try{const t=await E();if(!t&&e<2)return void setTimeout(()=>s(e+1),200);const n=await window.pywebview.api.get_report_faction_filter(t);n&&a.includes(n)?o.setValue(n):o.setValue("å…¨éƒ¨"),console.log("[å¸³è™Ÿåˆ‡æ›] ç•¶å‰å¸³è™Ÿ:",t,"æˆ°å ±é€šçŸ¥éŽæ¿¾:",o.getValue()),window.updateFactionFilter&&window.updateFactionFilter(o.getValue())}catch(e){console.error("ç²å–æˆ°å ±ç¯©é¸è¨­å®šå¤±æ•—:",e),o.setValue("å…¨éƒ¨"),window.updateFactionFilter&&window.updateFactionFilter("å…¨éƒ¨")}else o.setValue("å…¨éƒ¨"),window.updateFactionFilter&&window.updateFactionFilter("å…¨éƒ¨")}a.forEach(e=>{const t=document.createElement("div");t.textContent=e,t.dataset.value=e,t.style.cssText="\n            padding: 6px 8px;\n            cursor: pointer;\n            color: #fff;\n            transition: background-color 0.15s;\n        ",t.addEventListener("mouseenter",function(){this.style.backgroundColor="#3a3a3a"}),t.addEventListener("mouseleave",function(){this.dataset.value!==l&&(this.style.backgroundColor="")}),t.addEventListener("click",function(e){e.stopPropagation(),l=this.dataset.value,i.textContent=l,r.style.display="none",o.style.borderRadius="6px",Array.from(r.children).forEach(e=>{e.style.backgroundColor=e.dataset.value===l?"#3a3a3a":""}),async function(e){if(window.pywebview&&window.pywebview.api&&window.pywebview.api.save_report_faction_filter)try{const t=await E();console.log("[rf-faction-filter] è§¸ç™¼ save_report_faction_filter:",e,t);const n=await window.pywebview.api.save_report_faction_filter(e,t);console.log("[rf-faction-filter] save_report_faction_filter å›žå‚³:",n)}catch(e){console.error("ä¿å­˜æˆ°å ±ç¯©é¸è¨­å®šå¤±æ•—:",e)}else console.warn("[rf-faction-filter] pywebview API ä¸å­˜åœ¨ï¼Œæœªå‘¼å« save_report_faction_filter");window.updateFactionFilter&&window.updateFactionFilter(e)}(l)}),r.appendChild(t)}),o.appendChild(r),o.addEventListener("click",function(e){e.stopPropagation();const t="block"===r.style.display;r.style.display=t?"none":"block",o.style.borderRadius=t?"6px":"6px 6px 0 0"}),document.addEventListener("click",function(){r.style.display="none",o.style.borderRadius="6px"}),o.addEventListener("keydown",function(e){if("Enter"===e.key||" "===e.key){e.preventDefault();const t="block"===r.style.display;r.style.display=t?"none":"block",o.style.borderRadius=t?"6px":"6px 6px 0 0"}else"Escape"===e.key&&(r.style.display="none",o.style.borderRadius="6px")}),o.addEventListener("mouseenter",function(){"block"!==r.style.display&&(this.style.borderColor="#777",this.style.backgroundColor="#2a2a2a")}),o.addEventListener("mouseleave",function(){"block"!==r.style.display&&(this.style.borderColor="#555",this.style.backgroundColor="#222")}),o.getValue=()=>l,o.setValue=e=>{a.includes(e)&&(l=e,i.textContent=e,Array.from(r.children).forEach(e=>{e.style.backgroundColor=e.dataset.value===l?"#3a3a3a":""}))},t.appendChild(n),t.appendChild(o),e.appendChild(t),t.appendChild(n),t.appendChild(o),e.appendChild(t),window.syncFactionFilterFromConfig=s,window.addEventListener("pywebviewready",s),document.addEventListener("DOMContentLoaded",s),function e(){const t=document.getElementById("account-select");t?t.addEventListener("change",()=>{setTimeout(s,100);const e=document.querySelectorAll('input[name="account-radio"]');e&&t.selectedIndex>=0&&e.forEach((e,n)=>{e.checked=n===t.selectedIndex})}):setTimeout(e,1e3)}()}(e),e&&!document.getElementById("rf-download-status-area")){const r=document.createElement("div");r.id="rf-download-status-area",r.style.width="100%",r.style.padding="10px",r.style.marginBottom="10px",r.style.background="rgba(52, 152, 219, 0.2)",r.style.borderRadius="6px",r.style.border="1px solid rgba(52, 152, 219, 0.5)",r.innerHTML='\n            <div style="display:flex;align-items:center;">\n                <div id="control-download-spinner" style="margin-right:10px;width:16px;height:16px;border:2px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite;"></div>\n                <div id="control-download-status-text" style="font-size:0.95em;flex-grow:1;font-weight:500;">æº–å‚™å°±ç·’</div>\n                <div id="control-download-progress-text" style="font-size:0.9em;color:white;margin-left:8px;min-width:40px;text-align:right;">0%</div>\n            </div>\n            <div id="control-download-details" style="display:flex;justify-content:space-between;margin-top:10px;font-size:0.85em;color:#bbb;">\n                <div style="display:flex;gap:10px;">\n                    <span id="control-download-queue" style="white-space:nowrap;">éšŠåˆ—: 0</span>\n                    <span id="control-download-active" style="white-space:nowrap;">ä¸¦è¡Œ: 0</span>\n                </div>\n                <div>\n                    <span id="control-download-completed" style="white-space:nowrap;">å·²å®Œæˆ: 0</span>\n                </div>\n            </div>\n        ',e.appendChild(r);const a={queueLength:0,activeDownloads:0,downloadedCount:0,isDownloading:!1};function l(){window.pywebview?.api&&(window.isUnloading||Promise.resolve().then(()=>window.pywebview.api.get_resource_download_status()).then(e=>{if(window.isUnloading)return;const t=document.getElementById("rf-download-status-area"),n=document.getElementById("control-download-status-text"),o=document.getElementById("control-download-progress-text"),i=document.getElementById("control-download-queue"),r=document.getElementById("control-download-active"),l=document.getElementById("control-download-completed"),s=document.getElementById("control-download-spinner");if(!t||!n)return;const c="number"==typeof e.queueLength?e.queueLength:0,d="number"==typeof e.activeDownloads?e.activeDownloads:0,u=("number"==typeof e.maxWorkers&&e.maxWorkers,"number"==typeof e.downloadedCount?e.downloadedCount:0),p=Boolean(e.isDownloading);if(c!==a.queueLength||d!==a.activeDownloads||u!==a.downloadedCount||p!==a.isDownloading){Object.assign(a,{queueLength:c,activeDownloads:d,downloadedCount:u,isDownloading:p});const e=c+u,t=e>0?Math.floor(u/e*100):100;o.textContent=`${t}%`,p&&(c>0||d>0)?(n.textContent="ä¸‹è¼‰è³‡æºä¸­",s.style.display="block"):u>0?(n.textContent="å·²å®Œæˆ",s.style.display="none",o.textContent="100%"):(n.textContent="æº–å‚™å°±ç·’",s.style.display="none",o.textContent="0%"),e>0?(i.textContent=`éšŠåˆ—: ${c}`,r.textContent=`ä¸¦è¡Œ: ${d}`,l.textContent=`å·²å®Œæˆ: ${u}`):(i.textContent="éšŠåˆ—: 0",r.textContent="ä¸¦è¡Œ: 0",l.textContent="å·²å®Œæˆ: 0")}}).catch(e=>{console.error("ç²å–ä¸‹è¼‰ç‹€æ…‹å¤±æ•—",e)}))}l();let s=setInterval(l,150);window.addEventListener("beforeunload",()=>{window.isUnloading=!0,clearInterval(s)}),document.addEventListener("visibilitychange",()=>{window.isUnloading||(clearInterval(s),s=setInterval(l,document.hidden?500:150))})}if(e&&!document.getElementById("rf-esc-hint")){const c=document.createElement("div");c.id="rf-esc-hint",c.textContent="æŒ‰ ESC æ‰“é–‹/é—œé–‰æŽ§åˆ¶é¢æ¿",c.style.fontSize="0.8em",c.style.color="#aaa",c.style.textAlign="center",c.style.marginTop="10px",e.appendChild(c)}if(e&&!document.getElementById("desktop-buttons-container")){console.log("Creating desktop-buttons-container");const d=document.createElement("div");d.id="desktop-buttons-container",e.appendChild(d)}else console.log("desktop-buttons-container already exists or panel missing");!function(){const e="rf-dialog-styles";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent="\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n        \n        .rf-download-status {\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background-color: rgba(0, 0, 0, 0.9);\n            padding: 15px;\n            border-radius: 8px;\n            z-index: 10000;\n            color: white;\n            min-width: 300px;\n            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);\n            border: 1px solid #555;\n        }\n        .rf-download-status h3 {\n            margin-top: 0;\n            padding-bottom: 10px;\n            border-bottom: 1px solid #444;\n        }\n        .rf-download-status-close {\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            cursor: pointer;\n            font-size: 16px;\n        }\n        .rf-progress-bar {\n            height: 10px;\n            background-color: #333;\n            border-radius: 5px;\n            margin: 10px 0;\n            overflow: hidden;\n        }\n        .rf-progress-bar-fill {\n            height: 100%;\n            background-color: #4CAF50;\n            transition: width 0.3s;\n        }\n        .rf-download-stats {\n            display: flex;\n            justify-content: space-between;\n            margin-top: 15px;\n        }\n        .rf-download-stat {\n            text-align: center;\n            padding: 5px;\n            flex-grow: 1;\n        }\n    ",document.head.appendChild(t)}()}async function I(){if("#/portalmap"===location.hash)try{const{mapBox:e,markers:t}=await function(e,t,n=12e3){return new Promise((o,i)=>{const r=Date.now();!function a(){const l=document.querySelector(e);if(l){const e=l.querySelectorAll(t);if(e.length>0)return o({mapBox:l,markers:e})}if(Date.now()-r>n)return i("åœ°åœ–åŸŽå¸‚è¼‰å…¥é€¾æ™‚");setTimeout(a,300)}()})}(".PortalMap_mapBox__3WtlM",".PortalMap_marker__rzok1, .PortalMap_markerCapital__6ocPp"),n={};t.forEach(e=>{if(!e||!e.style)return;const t=e.style.backgroundColor;n[t]||(n[t]=0),n[t]++});const o=Object.entries(n).sort((e,t)=>t[1]-e[1]);let i='<div style="font-size:2em;font-weight:700;text-align:center;margin-bottom:18px;letter-spacing:2px;color:#fff;">é™£ç‡ŸåŸŽå¸‚æŽ’è¡Œæ¦œ</div>';i+='<div style="width:100%;">',i+='<div style="display:flex;justify-content:space-between;align-items:center;padding:0 8px 8px 8px;font-size:1.15em;font-weight:600;color:#fff;opacity:0.85;border-bottom:1.5px solid #444;">',i+="<span>é™£ç‡Ÿ</span><span>åŸŽå¸‚æ•¸</span></div>",o.forEach(([e,t])=>{const n=h(e);i+=`<div style="display:flex;align-items:center;justify-content:space-between;padding:12px 8px 12px 8px;font-size:1.18em;font-weight:500;">\n                <span style="display:flex;align-items:center;gap:12px;">\n                    <span style="display:inline-block;width:22px;height:22px;background:${e};border-radius:50%;border:2px solid #fff;box-shadow:0 1px 4px #0004;"></span>\n                    <span style="color:#fff;">${n}</span>\n                </span>\n                <span style="color:#fff;">${t}</span>\n            </div>`}),i+="</div>",document.getElementById("ranking-content").innerHTML=i}catch(e){document.getElementById("ranking-content").innerHTML="æŽ’è¡Œæ¦œè¼‰å…¥å¤±æ•—ï¼š"+e}}new Map,new Map;var S=o(564);o(191),o(415),o(435);let A=null;function M({useCanvas:e=!1}={}){let t={},n=document.getElementById("map-tooltip-optimized");function i(){n.style.display="none"}async function r(){const{loadMarkerDataFromYaml:e}=await Promise.resolve().then(o.bind(o,564)),{getCityName:r,getMarkerId:a}=await Promise.resolve().then(o.bind(o,191)),{showEditDialog:l,showDetailDialog:s}=await Promise.resolve().then(o.bind(o,415)),{drawConnectionLinesOptimized:c,clearConnectionLines:d,resetCityToMarkerCache:u}=await Promise.resolve().then(o.bind(o,435));t=await e(),u(),Array.from(document.querySelectorAll('[class^="PortalMap_marker"], [class^="PortalMap_markerCapital"]')).forEach(e=>{e._rf_marker_handlers&&(e.removeEventListener("mouseenter",e._rf_marker_handlers.mouseenter),e.removeEventListener("mousemove",e._rf_marker_handlers.mousemove),e.removeEventListener("mouseleave",e._rf_marker_handlers.mouseleave),e.removeEventListener("click",e._rf_marker_handlers.click),e.removeEventListener("dblclick",e._rf_marker_handlers.dblclick));const o=e.querySelector(".PortalMap_marker2swords__1V7ah");if(o&&"IMG"===o.tagName){const n=e.style.left||"",i=e.style.top||"",r=parseFloat(n.replace("calc(","").replace("%)",""))/100,l=parseFloat(i.replace("calc(","").replace("%)",""))/100,s=document.getElementById("faction-map-canvas");let c=r,d=l;s&&(c=Math.round(r*s.width),d=Math.round(l*s.height));let u=e.style.backgroundColor;u||(u=window.getComputedStyle(e).backgroundColor),o.dataset.x=c,o.dataset.y=d,o.dataset.color=u;const p=a(e),f=t[p]||{};let w=e.style.backgroundColor||"#888";if(f.faction&&window.getFactionColor)try{w=window.getFactionColor(f.faction)||w}catch{}window._soldierSvgCache||(window._soldierSvgCache={});let g=window._soldierSvgCache[w];g||(g="data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='56' height='48' viewBox='0 0 512 512'>\n                    <defs>\n                        <filter id='glow' x='-30%' y='-30%' width='160%' height='160%'>\n                            <feGaussianBlur stdDeviation='8' result='coloredBlur'/>\n                            <feMerge>\n                                <feMergeNode in='coloredBlur'/>\n                                <feMergeNode in='SourceGraphic'/>\n                            </feMerge>\n                        </filter>\n                    </defs>\n                    <path d='M148.204,202.609l1.379,23.581c0.237,4.028,2.331,7.717,5.669,9.982c3.32,2.252,7.519,2.856,11.369,1.58l12.621-4.183L148.204,202.609z M511.983,153.352c-0.304-5.214-4.628-9.238-9.784-9.238c-0.193,0-0.387,0.006-0.582,0.017l-14.706,0.86l-0.501-8.569c-0.306-5.214-4.628-9.238-9.784-9.238c-0.193,0-0.387,0.006-0.582,0.017c-5.409,0.317-9.536,4.957-9.221,10.366l0.501,8.569l-79.533,4.652l-19.782-35.024c-1.920-3.335-5.518-5.35-9.365-5.218l-79.706,2.543c-4.735,0.151-8.772,3.476-9.829,8.094l-5.615,24.55l21.907-1.093l2.237-10.971l65.423-2.087l11.491,20.567l-14.716,0.861c13.8,20.885,5.559,48.911-16.953,59.171l-6.104,2.782l10.304,30.286c3.954,11.623,16.581,17.832,28.194,13.879c11.618-3.953,17.832-16.575,13.879-28.194c-11.117-32.675-8.724-25.643-13.659-40.147l37.381-2.186c5.409-0.317,9.536-4.957,9.221-10.366c-0.247-4.218-3.128-7.647-6.949-8.806l97.611-5.708C508.172,163.402,512.299,158.762,511.983,153.352z M206.773,53.045c-26.768-4.088-51.798,14.296-55.888,41.077c-4.526,29.623,18.376,56.458,48.543,56.458c23.815,0,44.716-17.381,48.423-41.647C251.941,82.157,233.549,57.134,206.773,53.045z M336.32,166.143c-5.09-11.167-18.271-16.092-29.436-11.004l-81.045,36.939c-8.178-4.584-66.046-37.059-74.61-41.822c-11.75-6.535-16.266-19.697-16.266-19.697c-9.933-0.071-19.482,3.832-26.521,10.839c-7.039,7.008-10.984,16.54-10.957,26.472c0.528,61.581,0.432,111.869,0.351,133.039c-0.027,6.905,1.002,13.896,3.043,20.491c4.407,14.247,13.026,43.684,22.571,84.787H26.665C11.938,406.19,0,418.128,0,432.855c0,14.727,11.938,26.665,26.665,26.665h130.432c8.143,0,15.84-3.721,20.898-10.103c5.058-6.382,6.922-14.726,5.063-22.652l-22.422-95.568l73.378-7.277l-16.648,104.75c-2.567,16.15,9.895,30.854,26.367,30.854c12.883,0,24.216-9.358,26.302-22.483l22.072-138.882c1.298-8.162-1.263-16.465-6.933-22.479c-5.67-6.014-13.805-9.059-22.032-8.242l-57.92,5.744l0.148-13.942c-2.717-2.2-2.532-2.137-15.431-15.003l-19.073,6.32c-7.552,2.502-16.143,1.556-23.185-3.223c-6.761-4.588-11.083-12.198-11.56-20.356c-1.913-32.717-2.021-31.378-1.465-35.068c14.386,8.063-4.26-2.388,79.287,44.443c6.176,3.464,13.635,3.775,20.079,0.838l91.297-41.612C336.484,190.488,341.41,177.31,336.32,166.143z' fill='${w}' filter='url(#glow)'/>\n                    </svg>`),window._soldierSvgCache[w]=g),o.src!==g&&(o.src=g),o.onerror=function(){this.style.display="none"},o.onload=function(){this.style.display=""};const m=e.style.left,y=e.style.top;m&&(o.style.left=m),y&&(o.style.top=y),o.style.transform="translate(-50%, -50%) scale(0.65)",o.style.backgroundColor="",o.style.borderRadius="",o.style.filter="",o.style.mixBlendMode="",o.style.boxShadow="none",o.style.background="none",o.style.border="none"}e.style.cursor="pointer",e.style.boxShadow=`0 0 8px 2px ${e.style.backgroundColor}, 0 0 18px 6px ${e.style.backgroundColor.replace(")",",0.35)")}`,e.style.transition="box-shadow 0.2s";const u=null!==e.querySelector(".PortalMap_marker2swords__1V7ah"),p=function(o){const i=a(e),l=t[i];!function(e,t){n.textContent=t,n.style.display="block";let o=e.clientX+12,i=e.clientY+8;setTimeout(()=>{const e=n.getBoundingClientRect(),t=window.innerWidth,r=window.innerHeight;e.right>t-8&&(o=t-e.width-8),e.bottom>r-8&&(i=r-e.height-8),o<8&&(o=8),i<8&&(i=8),n.style.left=o+"px",n.style.top=i+"px"},0)}(o,l&&l.cityName?l.cityName:r(e)),d(),l&&l.airport&&c(e,t,"airport"),l&&l.port&&c(e,t,"port")},f=function(e){n.style.left=e.clientX+12+"px",n.style.top=e.clientY+8+"px"},w=function(){i(),d(),n.textContent=""},g=function(o){1===o.detail&&setTimeout(()=>{e._dblClicked||(u?e.dataset&&e.dataset.url&&window.open(e.dataset.url,"_blank"):s(e,t)),e._dblClicked=!1,i(),d(),n.textContent=""},200)},m=function(o){e._dblClicked=!0,u?s(e,t):l(e,t),i(),d(),n.textContent=""};e.addEventListener("mouseenter",p),e.addEventListener("mousemove",f),e.addEventListener("mouseleave",w),e.addEventListener("click",g),e.addEventListener("dblclick",m),e._rf_marker_handlers={mouseenter:p,mousemove:f,mouseleave:w,click:g,dblclick:m}})}n||(n=document.createElement("div"),n.id="map-tooltip-optimized",n.style.position="fixed",n.style.background="rgba(30,30,30,0.92)",n.style.color="#fff",n.style.padding="6px 12px",n.style.borderRadius="8px",n.style.pointerEvents="none",n.style.zIndex=99999,n.style.fontSize="1em",n.style.display="none",document.body.appendChild(n)),r();const a=document.querySelector(".PortalMap_mapBox__3WtlM");a&&(A&&A.disconnect(),A=new MutationObserver(()=>{r()}),A.observe(a,{childList:!0,subtree:!0}))}const L="rf-custom-highlighter";let T=null,F=null,B=!1,N="å…¨éƒ¨";function O(e){const t=document.getElementById(L);if(!t)return;const n=e.trim(),o=b();let i,r,a,l=null,s=-1;for(const e of o){const t=n.indexOf(e.name);-1!==t&&(-1===s||t<s)&&(s=t,l=e)}if(l){const e=function(e){const t=y.find(t=>t.name===e);return t?t.color:"rgb(109,109,109)"}(l.name);a=function(e){if(!e||!e.startsWith("rgb"))return!1;const t=e.match(/\d+/g);if(!t||t.length<3)return!1;const[n,o,i]=t.map(Number);return(299*n+587*o+114*i)/1e3>=186}(e)?"#222":"white";const t=t=>e.replace("rgb","rgba").replace(")",`, ${t})`);i=t(.3),r=t(.25)}else a="#222",i="rgba(255, 255, 0, 0.2)",r="rgba(255, 255, 0, 0.25)";const c=window.innerWidth/80,d=Math.max(16,Math.min(c,24));t.textContent=n,t.style.color=a,t.style.backgroundColor=i,t.style.boxShadow=`0 0 12px 4px ${r}`,t.style.fontSize=`${d}px`}async function $(){if(B)return;B=!0,function(){if(document.getElementById(L))return;const e=document.createElement("div");e.id=L,Object.assign(e.style,{display:"inline-block",position:"fixed",top:"82px",left:"50%",zIndex:"10001",padding:"4px 10px",borderRadius:"8px",fontWeight:"bold",textAlign:"center",whiteSpace:"nowrap",pointerEvents:"none",opacity:"0",transform:"translateX(-50%)",transition:"opacity 0.4s ease-in-out",willChange:"opacity"}),document.body.appendChild(e);const t=document.createElement("style");t.id=`${L}-style`,t.innerHTML="\n        .ShortMessage_messageText__uLw0A {\n            display: none !important;\n            visibility: hidden !important;\n        }\n    ",document.head.appendChild(t)}();const e=e=>{if(e&&e.textContent){const t=e.textContent.trim();t&&function(e){if(!function(e){if("å…¨éƒ¨"===N)return!0;const t=function(e){const t=b();for(const n of t)if(e.includes(n.name))return n.name;return null}(e);return t===N}(e))return;const t=document.getElementById(L);if(!t)return;T&&clearTimeout(T);const n=e.trim();n===F&&"1"===t.style.opacity||(F=n,O(n),t.style.opacity="1"),T=setTimeout(()=>{t.style.opacity="0",F=null},4e3)}(t)}},t=document.querySelector(".ShortMessage_messageText__uLw0A");if(t&&e(t),window.addEventListener("resize",()=>{F&&O(F)}),new MutationObserver(t=>{for(const n of t){let t=null;if("childList"===n.type?n.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(t=e.matches(".ShortMessage_messageText__uLw0A")?e:e.querySelector(".ShortMessage_messageText__uLw0A"))}):"characterData"===n.type&&(t=n.target.parentElement?.closest(".ShortMessage_messageText__uLw0A")),t)return void e(t)}}).observe(document.body,{childList:!0,subtree:!0,characterData:!0}),window.pywebview&&window.pywebview.api&&window.pywebview.api.get_report_faction_filter)try{const e=await async function(){const e=function(){const e=document.getElementById("account-select");return!e||e.selectedIndex<0?null:{accountIdx:e.selectedIndex,account:e.options[e.selectedIndex].text}}();if(!e)return null;try{const t=await window.pywebview.api.get_accounts();if(t&&e.accountIdx<t.length)return t[e.accountIdx]}catch(e){console.error("ç²å–å¸³è™Ÿåˆ—è¡¨å¤±æ•—:",e)}return null}(),t=await window.pywebview.api.get_report_faction_filter(e);N=t||"å…¨éƒ¨"}catch(e){console.error("ç²å–æˆ°å ±ç¯©é¸è¨­å®šå¤±æ•—:",e),N="å…¨éƒ¨"}}window.updateFactionFilter=function(e){N=e},console.log("entrypoint.js: ç«‹å³åˆå§‹åŒ–è¦–çª—ç®¡ç†å™¨");try{w(),console.log("entrypoint.js: è¦–çª—ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ")}catch(e){console.error("entrypoint.js: è¦–çª—ç®¡ç†å™¨åˆå§‹åŒ–å¤±æ•—",e)}function D(){if(document.getElementById("custom-controls-toggle"))return;const e=document.querySelector("main")||document.body,t=!!window.pywebview||window.__TAURI__&&!!window.__TAURI__.core;console.log("insertCustomControlsDOM: isDesktop =",t,"window.pywebview =",!!window.pywebview,"Tauri =",!(!window.__TAURI__||!window.__TAURI__.core));const n=t?"position:fixed;top:20%;left:50%;":"position:fixed;top:16px;left:16px;";e.insertAdjacentHTML("beforeend",`\n    <div id="custom-controls-toggle" aria-label="å±•é–‹åŠŸèƒ½é¸å–®" style="${n}z-index:10000;background:#222c;backdrop-filter:blur(2px);border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 2px 12px #000a;">\n        <img src="./static/media/logo_monthlycard.fc4baca34b9e97ab8974.png" alt="åŠŸèƒ½é¸å–®" style="width:32px;height:32px;object-fit:contain;"/>\n    </div>\n    <div id="custom-controls" style="position:fixed;z-index:9999;background:rgba(34,34,34,0.82);backdrop-filter:blur(4px);border-radius:10px;padding:20px 18px 16px 18px;box-shadow:0 2px 12px #000a;color:#fff;min-width:220px;max-width:420px;font-family:sans-serif;display:none;transition:transform 0.2s cubic-bezier(.4,2,.6,1);max-height:88vh;overflow:auto;">\n        <div style="margin-bottom:12px;font-size:1.1em;font-weight:bold;letter-spacing:1px;">åŠŸèƒ½é¸å–®</div>\n        <button id="show-portalmap-ranking" aria-label="é¡¯ç¤ºé™£ç‡Ÿæ“šé»žæŽ’è¡Œæ¦œ" style="width:100%;margin-bottom:10px;background:#2a7cff;color:#fff;border:none;padding:8px 0;border-radius:6px;cursor:pointer;">é™£ç‡Ÿæ“šé»žæŽ’è¡Œæ¦œ</button>\n        <button id="toggle-faction-map" aria-label="é¡¯ç¤ºå‹¢åŠ›åˆ†å¸ƒåœ–" style="width:100%;margin-bottom:10px;background:#1dbf60;color:#fff;border:none;padding:8px 0;border-radius:6px;cursor:pointer;">é¡¯ç¤ºå‹¢åŠ›åˆ†å¸ƒåœ–</button>\n        <div id="account-section"></div>\n        <div id="account-status" style="margin-top:6px;font-size:0.92em;color:#7fffd4;"></div>\n        \x3c!-- éŸ³é‡æŽ§åˆ¶ã€æˆ°å ±éŽæ¿¾ã€ä¸‹è¼‰ç‹€æ…‹å°‡ç”± setupCustomControls å‹•æ…‹æ·»åŠ  --\x3e\n        \x3c!-- ESC æç¤ºå°‡ç”± setupCustomControls å‹•æ…‹æ·»åŠ  --\x3e\n        \x3c!-- æ¡Œé¢å°ˆå±¬æŒ‰éˆ•ï¼ˆé€€å‡ºã€å…¨èž¢å¹•ï¼‰å®¹å™¨å°‡ç”± setupCustomControls å‰µå»ºä¸¦åœ¨æœ€å¾Œæ·»åŠ  --\x3e\n    </div>\n    <div id="ranking-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:12000;background:none;align-items:center;justify-content:center;pointer-events:auto;overflow:hidden;">\n      <div id="ranking-panel" style="background:rgba(30,34,44,0.92);padding:3vw 2vw 2vw 2vw;border-radius:22px;min-width:320px;max-width:96vw;width:min(540px,92vw);max-height:88vh;overflow:auto;box-shadow:0 4px 32px #0008;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center;backdrop-filter:blur(6px);pointer-events:auto;cursor:move;">\n        <button id="close-ranking-modal" aria-label="é—œé–‰æŽ’è¡Œæ¦œ" style="position:absolute;top:14px;right:18px;background:rgba(60,60,60,0.7);color:#fff;border:none;border-radius:50%;width:36px;height:36px;font-size:1.3em;cursor:pointer;z-index:1;box-shadow:0 2px 8px #000a;">Ã—</button>\n        <div id="ranking-content" style="margin-top:8px;width:100%;max-height:70vh;overflow:auto;"></div>\n      </div>\n    </div>\n    <div id="faction-map-canvas-container" style="position:absolute;left:0;top:0;width:100vw;height:100vh;pointer-events:none;z-index:1000;display:none;">\n        <canvas id="faction-map-canvas" width="1920" height="1080" style="width:100vw;height:100vh;"></canvas>\n    </div>\n    `);const o=document.getElementById("custom-controls"),i=document.getElementById("custom-controls-toggle");function r(){o&&(o.style.display="none")}function a(){const e=document.getElementById("custom-controls");e&&(window.innerWidth<=600?(e.style.width="96vw",e.style.maxWidth="96vw",e.style.minWidth="0",e.style.left="2vw",e.style.right="2vw",e.style.top="12vw",e.style.borderRadius="12px",e.style.transform="none"):(e.style.width="320px",e.style.maxWidth="420px",e.style.minWidth="220px",e.style.left="",e.style.right="20px",e.style.top="20px",e.style.borderRadius="10px",e.style.transform="none"))}i&&o&&i.addEventListener("click",function(){""===o.style.display||"block"===o.style.display?r():o&&i&&(o.style.display="",requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=i.getBoundingClientRect();let t=window.innerWidth<=600?Math.floor(.96*window.innerWidth):320;t=Math.max(220,Math.min(420,t)),o.style.width=t+"px",o.style.maxWidth="420px",o.style.minWidth="220px";let n=e.left+e.width+12;n+t>window.innerWidth&&(n=e.left-t-12),n=Math.max(0,Math.min(window.innerWidth-t,n));let r=e.top;const a=Math.min(o.offsetHeight||480,.88*window.innerHeight);r+a>window.innerHeight&&(r=window.innerHeight-a-12),r=Math.max(0,r),o.style.left=n+"px",o.style.top=r+"px",o.style.right="",o.style.borderRadius=window.innerWidth<=600?"12px":"10px"})}))}),document.addEventListener("mousedown",function(e){o&&"none"!==o.style.display&&!o.contains(e.target)&&e.target!==i&&r()}),window.addEventListener("resize",a),a()}setTimeout(()=>{console.log("entrypoint.js: å»¶é²åˆå§‹åŒ–éµç›¤æŽ§åˆ¶"),window._keyboardInitDone||(window._keyboardInitDone=!0,console.log("é€šéŽæ¨¡å¡Šåˆå§‹åŒ–éµç›¤æŽ§åˆ¶"),window.addEventListener("keydown",function(e){if(console.log("æŒ‰éµæŒ‰ä¸‹:",e.key,e.keyCode),"Escape"!==e.key&&27!==e.keyCode||(console.log("è§¸ç™¼ESCåˆ‡æ›åŠŸèƒ½é¸å–®"),window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_menu&&(window.pywebview.api.toggle_menu(),e.preventDefault())),"F11"===e.key||122===e.keyCode)return console.log("keyboardInit: è§¸ç™¼F11å…¨å±åˆ‡æ› - æ¨¡å¡Šåˆå§‹åŒ–"),window.rfToggleFullscreen&&"function"==typeof window.rfToggleFullscreen?(console.log("keyboardInit: ä½¿ç”¨çª—å£ç®¡ç†å™¨è™•ç†F11"),window.rfToggleFullscreen()):window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_fullscreen&&(console.log("keyboardInit: ä½¿ç”¨APIè™•ç†F11"),window.pywebview.api.toggle_fullscreen()),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1},!0)),window.onUpdateFound=function(e,t,n){if(console.log("[Update] ç™¼ç¾æ–°ç‰ˆæœ¬:",t,e),document.getElementById("rf-update-modal"))return;const o=document.createElement("div");o.id="rf-update-modal",o.style.cssText='\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0,0,0,0.7);\n            z-index: 20000;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            backdrop-filter: blur(4px);\n            font-family: "Microsoft JhengHei", sans-serif;\n        ';const i=document.createElement("div");i.style.cssText="\n            background: #222;\n            color: #fff;\n            padding: 24px;\n            border-radius: 12px;\n            width: 400px;\n            max-width: 90%;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.5);\n            border: 1px solid #444;\n            text-align: center;\n            animation: fadeIn 0.3s ease-out;\n        ";const r=document.createElement("style");r.textContent="\n            @keyframes fadeIn {\n                from { opacity: 0; transform: scale(0.9); }\n                to { opacity: 1; transform: scale(1); }\n            }\n        ",document.head.appendChild(r),i.innerHTML=`\n            <h2 style="margin-top:0;color:#4CAF50;font-size:1.5em;">ç™¼ç¾æ–°ç‰ˆæœ¬ v${t}</h2>\n            <p style="margin: 20px 0; color: #ccc; line-height: 1.5;">\n                æª¢æ¸¬åˆ°æ–°çš„æ‡‰ç”¨ç¨‹å¼ç‰ˆæœ¬ã€‚<br>\n                æ˜¯å¦ç«‹å³ä¸‹è¼‰ä¸¦å®‰è£ï¼Ÿ\n            </p>\n            <div style="display:flex;justify-content:center;gap:16px;margin-top:24px;">\n                <button id="btn-update-confirm" style="padding:10px 24px;background:#4CAF50;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1em;transition:background 0.2s;">ç«‹å³æ›´æ–°</button>\n                <button id="btn-update-cancel" style="padding:10px 24px;background:#555;color:white;border:none;border-radius:6px;cursor:pointer;font-size:1em;transition:background 0.2s;">ç¨å¾Œå†èªª</button>\n            </div>\n        `,o.appendChild(i),document.body.appendChild(o);const a=document.getElementById("btn-update-cancel"),l=document.getElementById("btn-update-confirm");a.onmouseover=()=>a.style.background="#666",a.onmouseout=()=>a.style.background="#555",l.onmouseover=()=>l.style.background="#45a049",l.onmouseout=()=>l.style.background="#4CAF50",a.onclick=()=>{o.remove()},l.onclick=async()=>{l.disabled=!0,l.textContent="ä¸‹è¼‰ä¸­...",l.style.background="#666",l.style.cursor="wait",a.style.display="none";const t=i.querySelector("p");if(t&&(t.textContent="æ­£åœ¨ä¸‹è¼‰æ›´æ–°æª”ï¼Œä¸‹è¼‰å®Œæˆå¾Œå°‡è‡ªå‹•é‡å•Ÿå®‰è£..."),window.pywebview&&window.pywebview.api&&window.pywebview.api.perform_update)try{await window.pywebview.api.perform_update(n,e)}catch(e){console.error("Update failed:",e),t.textContent="æ›´æ–°å¤±æ•—: "+e,t.style.color="#ff5252",l.textContent="é‡è©¦",l.disabled=!1,l.style.background="#4CAF50",l.style.cursor="pointer",a.style.display="inline-block"}else alert("ç„¡æ³•èª¿ç”¨æ›´æ–° API"),o.remove()}},console.log("Update prompt initialized")},500);let z=!1;document.addEventListener("DOMContentLoaded",()=>{z||(console.log("DOMContentLoaded: èª¿ç”¨ insertCustomControlsDOM"),D(),z=!0)}),"loading"===document.readyState||(console.log("Document already loaded: èª¿ç”¨ insertCustomControlsDOM"),D(),z=!0),console.log((()=>{try{const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return"WebGL not supported";const n=t.getExtension("WEBGL_debug_renderer_info");return n?t.getParameter(n.UNMASKED_RENDERER_WEBGL):"No debug info"}catch(e){return"Error: "+e}})());let j=!1,P=!1;async function R(){if(P)return;P=!0,document.getElementById("custom-controls")||D();const t=document.getElementById("account-section");t&&(await n(t,i),i(),function(t,o){const i=()=>{let i=document.querySelector(".Login_loginFormBox__LKcQJ");if(!i){const e=document.querySelector('input[type="password"]');if(e){let t=e.parentElement,n=0;for(;t&&t!==document.body&&n<5;){if(t.querySelector("button")||t.querySelector('[class*="Btn"]')){i=t;break}t=t.parentElement,n++}}}if(i&&!i.dataset.interceptorAttached){let r=i.querySelector(".Login_formBtn__L1ZuE");r||(r=i.querySelector("button")),r||(r=i.querySelector('input[type="submit"]')),r||(r=i.querySelector('[class*="Btn"]')),r||(r=i.querySelector('[class*="btn"]')),r||(r=i.querySelector('[role="button"]'));const a=i.querySelector('input[type="text"]'),l=i.querySelector('input[type="password"]');if(a&&l){i.dataset.interceptorAttached="true";const s=async()=>{const i=a.value,r=l.value;if(i&&r)try{await e.F7({account:i,password:r});const a=await e.P4(),l=a.findIndex(e=>e.account===i);if(-1!==l){window.currentSelectedAccountIdx=l,sessionStorage.setItem("currentSelectedAccountIdx",l),t&&n(t,o),window.syncAudioControlsWithConfig&&window.syncAudioControlsWithConfig(a[l]),window.syncFactionFilterFromConfig&&setTimeout(window.syncFactionFilterFromConfig,300);const e=document.getElementById("account-select");e&&(e.selectedIndex=l,e.dispatchEvent(new Event("change",{bubbles:!0})))}}catch(e){console.error("Failed to save account on login:",e)}};r&&(r.addEventListener("mousedown",s),r.addEventListener("click",e=>{}));const c=e=>{"Enter"===e.key&&s()};l.addEventListener("keydown",c),a.addEventListener("keydown",c)}}};new MutationObserver(e=>{i()}).observe(document.body,{childList:!0,subtree:!0}),i()}(t,i),setTimeout(()=>{window.syncAudioControlsWithConfig&&window.syncAudioControlsWithConfig()},500));let o=document.getElementById("desktop-buttons-container");if(o||(C(),o=document.getElementById("desktop-buttons-container")),o&&!document.getElementById("exit-app")){o.innerHTML='\n            <button id="exit-app" aria-label="é€€å‡ºéŠæˆ²" style="width:100%;margin-bottom:10px;background:#d9534f;color:#fff;border:none;padding:8px 0;border-radius:6px;cursor:pointer;margin-top:10px;">é€€å‡ºéŠæˆ²</button>\n            <button id="toggle-fullscreen" aria-label="åˆ‡æ›å…¨èž¢å¹•/è¦–çª—" style="width:100%;margin-bottom:0;background:#333c;color:#fff;border:none;padding:8px 0;border-radius:6px;cursor:pointer;">åˆ‡æ›å…¨èž¢å¹•/è¦–çª—</button>\n        ';const e=document.getElementById("exit-app");e&&(e.onclick=function(){window.pywebview.api.exit_app&&window.pywebview.api.exit_app()});const t=document.getElementById("toggle-fullscreen");t&&(t.onclick=function(){window.pywebview.api.toggle_fullscreen&&window.pywebview.api.toggle_fullscreen()})}}window.addEventListener("pywebviewready",async function(){window.pywebview&&await R()}),window.pywebview&&R(),document.addEventListener("DOMContentLoaded",async()=>{z||(D(),z=!0),function(){let e=null,t="";document.getElementById("show-portalmap-ranking").onclick=async function(){location.hash="#/portalmap",document.getElementById("ranking-modal").style.display="flex",t=location.hash,await I(),e&&clearInterval(e),e=setInterval(()=>{"#/portalmap"===location.hash&&I()},2e3)},document.getElementById("close-ranking-modal").onclick=function(){document.getElementById("ranking-modal").style.display="none",e&&clearInterval(e)},window.addEventListener("hashchange",function(){"flex"===document.getElementById("ranking-modal").style.display&&("#/portalmap"===location.hash?(I(),e&&clearInterval(e),e=setInterval(()=>{"#/portalmap"===location.hash&&I()},2e3)):e&&clearInterval(e))})}(),C(),function(){const e=document.getElementById("ranking-panel");let t=!1,n=0,o=0,i=0,r=0;e.addEventListener("mousedown",function(a){if(0!==a.button||"close-ranking-modal"===a.target.id)return;t=!0,n=a.clientX,o=a.clientY;const l=e.getBoundingClientRect();i=l.left,r=l.top,e.style.transition="none",document.body.style.userSelect="none"}),window.addEventListener("mousemove",function(a){if(!t)return;let l=a.clientX-n,s=a.clientY-o;e.style.left=i+l+"px",e.style.top=r+s+"px",e.style.transform="none"}),window.addEventListener("mouseup",function(){t=!1,document.body.style.userSelect=""}),e.style.position="fixed",e.style.top=e.style.top||"50%",e.style.left=e.style.left||"50%",e.style.transform=e.style.transform||"translate(-50%,-50%)"}();try{await $(),j||(M(),j=!0),document.addEventListener("keydown",function(e){if(("F11"===e.key||122===e.keyCode)&&(console.log("entrypoint.js æ•ç²F11æŒ‰éµï¼Œè§¸ç™¼å…¨å±åˆ‡æ›"),window.pywebview&&window.pywebview.api&&window.pywebview.api.toggle_fullscreen))return window.pywebview.api.toggle_fullscreen(),e.preventDefault(),!1},!0),setTimeout(()=>{window.pywebview&&window.syncAudioControlsWithConfig&&(console.log("DOMContentLoaded: è§¸ç™¼é¡å¤–çš„éŸ³é‡æŽ§åˆ¶åŒæ­¥æª¢æŸ¥"),window.syncAudioControlsWithConfig())},2e3)}catch(e){}});let q=0;setInterval(()=>{try{const e=document.querySelectorAll('[class^="PortalMap_marker"], [class^="PortalMap_markerCapital"]');e.length!==q&&(M(),q=e.length)}catch(e){}},1e3),window.saveMarkerDataToYaml=S.O;const W=document.getElementById("custom-controls-toggle");let U=!1,H=0,G=0;if(W.addEventListener("mousedown",function(e){U=!0,H=e.offsetX,G=e.offsetY,document.body.style.userSelect="none"}),window.addEventListener("mousemove",function(e){if(!U)return;const t=W.offsetWidth,n=W.offsetHeight;let o=e.clientX-H,i=e.clientY-G;o=Math.max(0,Math.min(window.innerWidth-t,o)),i=Math.max(0,Math.min(window.innerHeight-n,i)),W.style.left=`${o}px`,W.style.top=`${i}px`}),window.addEventListener("mouseup",function(){U=!1,document.body.style.userSelect=""}),window.setupMarkerInteractionOptimized){const e=window.setupMarkerInteractionOptimized;window.setupMarkerInteractionOptimized=function(...t){e.apply(this,t),window.pywebview||setTimeout(()=>{document.querySelectorAll('[class^="PortalMap_marker"], [class^="PortalMap_markerCapital"]').forEach(e=>{e.replaceWith(e.cloneNode(!0))})},500)}}o(289),function(){let e=parseInt(sessionStorage.getItem("rf_load_count")||"0")+1;sessionStorage.setItem("rf_load_count",e.toString());const t=(new Date).toISOString(),n=sessionStorage.getItem("rf_prev_load_time");if(n){const t=new Date-new Date(n);console.log(`%c[é é¢åŠ è¼‰] ç¬¬ ${e} æ¬¡åŠ è¼‰ (è·é›¢ä¸Šæ¬¡ ${t}ms)`,"color: #00ff00; font-size: 14px; font-weight: bold")}else console.log(`%c[é é¢åŠ è¼‰] ç¬¬ ${e} æ¬¡åŠ è¼‰`,"color: #00ff00; font-size: 14px; font-weight: bold");sessionStorage.setItem("rf_prev_load_time",t),e>3&&console.error(`%c[è­¦å‘Š] é é¢åœ¨çŸ­æ™‚é–“å…§é‡è¤‡åŠ è¼‰ ${e} æ¬¡ï¼`,"color: #ff0000; font-size: 16px; font-weight: bold");let o=window.location.href;setInterval(()=>{window.location.href!==o&&(console.log(`%c[å°Žèˆªè®ŠåŒ–] ${o} -> ${window.location.href}`,"color: #ffaa00; font-size: 12px"),o=window.location.href)},100);const i=history.pushState,r=history.replaceState;history.pushState=function(...e){return console.log("[History] pushState:",e[2]),i.apply(this,e)},history.replaceState=function(...e){return console.log("[History] replaceState:",e[2]),r.apply(this,e)},window.addEventListener("popstate",e=>{console.log("[History] popstate:",window.location.href)}),window.addEventListener("error",e=>{const t=e.target&&("AUDIO"===e.target.tagName||"VIDEO"===e.target.tagName||"IMG"===e.target.tagName);console.error("[å…¨å±€éŒ¯èª¤]",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error,target:e.target?.tagName,isMediaError:t}),t&&(e.stopPropagation(),e.stopImmediatePropagation(),console.warn(`%c[åª’é«”éŒ¯èª¤å·²æ””æˆª] ${e.target.tagName}: ${e.target.src}`,"color: #ffaa00; font-size: 12px")),e.preventDefault()},!0),window.addEventListener("unhandledrejection",e=>{console.error("[æœªè™•ç†çš„Promiseæ‹’çµ•]",e.reason),e.preventDefault()}),window.addEventListener("error",e=>{e.target!==window&&(console.warn("[è³‡æºåŠ è¼‰å¤±æ•—]",{tagName:e.target.tagName,src:e.target.src||e.target.href,currentSrc:e.target.currentSrc}),e.stopPropagation(),e.preventDefault())},!0);let a=0;window.addEventListener("beforeunload",t=>{a++,console.error(`%c[å³å°‡å¸è¼‰ #${a}] é é¢å³å°‡é‡æ–°åŠ è¼‰æˆ–é—œé–‰`,"color: #ff6600; font-size: 14px; font-weight: bold"),console.trace("[å¸è¼‰å †æ£§] è§¸ç™¼ä¾†æº:");const n={count:a,time:(new Date).toISOString(),url:window.location.href,loadCount:e};sessionStorage.setItem("rf_last_unload",JSON.stringify(n))});const l=sessionStorage.getItem("rf_last_unload");if(l)try{const e=JSON.parse(l),t=new Date-new Date(e.time);console.warn(`%c[å¸è¼‰è³‡è¨Š] ä¸Šæ¬¡å¸è¼‰æ–¼ ${t}ms å‰`,"color: #ff9900; font-size: 12px",e)}catch(e){}try{window.location.reload&&(window.location.reload=function(...e){console.error("%c[é˜»æ­¢é‡è¼‰] location.reload() è¢«èª¿ç”¨","color: #ff0000; font-size: 16px; font-weight: bold"),console.trace("[é˜»æ­¢é‡è¼‰] èª¿ç”¨å †æ£§:")})}catch(e){console.warn("[è¨ºæ–·] location.reload ä¸å¯è¦†è“‹ (é€™æ˜¯æ­£å¸¸çš„):",e.message)}try{const e=window.location.replace;e&&(window.location.replace=function(t){return t&&t!==window.location.href?e.call(this,t):(console.error("%c[é˜»æ­¢é‡è¼‰] location.replace() åŒ URL è¢«æ””æˆª","color: #ff0000; font-size: 16px; font-weight: bold"),void console.trace("[é˜»æ­¢é‡è¼‰] èª¿ç”¨å †æ£§:"))})}catch(e){console.warn("[è¨ºæ–·] location.replace ä¸å¯è¦†è“‹:",e.message)}try{const e=window.location.assign;e&&(window.location.assign=function(t){return t&&t!==window.location.href?e.call(this,t):(console.error("%c[é˜»æ­¢é‡è¼‰] location.assign() åŒ URL è¢«æ””æˆª","color: #ff0000; font-size: 16px; font-weight: bold"),void console.trace("[é˜»æ­¢é‡è¼‰] èª¿ç”¨å †æ£§:"))})}catch(e){console.warn("[è¨ºæ–·] location.assign ä¸å¯è¦†è“‹:",e.message)}try{const e=window.history.go;e&&(window.history.go=function(t){return 0===t||void 0===t?(console.error("%c[é˜»æ­¢é‡è¼‰] history.go(0) è¢«æ””æˆª","color: #ff0000; font-size: 16px; font-weight: bold"),void console.trace("[é˜»æ­¢é‡è¼‰] èª¿ç”¨å †æ£§:")):e.call(this,t)})}catch(e){console.warn("[è¨ºæ–·] history.go ä¸å¯è¦†è“‹:",e.message)}console.log("%c[è¢«å‹•åŠ è¼‰æ¨¡å¼] é‡è¼‰ç›£æŽ§å·²å•Ÿå‹• (ç›¡åŠ›è€Œç‚º)","color: #00ff00; font-size: 14px; font-weight: bold"),console.log("[è¨ºæ–·] å…¨å±€éŒ¯èª¤ç›£è½å·²å•Ÿå‹•")}()})()})();